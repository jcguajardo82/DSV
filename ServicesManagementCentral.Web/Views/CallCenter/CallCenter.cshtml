@using System.Data;
@{
    ViewBag.Title = "Call Center";
}

@*<div id="spinner">
        <img src="~/Content/images/spinner-icon-gif-24.gif" style="display:none;" id="imgSpiner" />
    </div>*@

<div id="spinner">
    <img src="~/Content/images/spinner-icon-gif-24.gif" style="display:none;" id="imgSpiner" />
</div>

<div class="row">

    <div class="col-xs-6 col-md-6 col-lg-6">

        <div class="form-group">

            @*<label>Tiena</label>*@
            <select class="form-control m-b" id="ddlTdas">
                <option value="0">--SELECCIONAR TIENDA--</option>
                @{
                    DataSet ds = (DataSet)ViewBag.tdas;


                    foreach (DataRow item in ds.Tables[0].Rows)
                    {

                        if (Session["Id_Num_UN"] != null)
                        {
                            if (@item["id_num_un"].ToString() == Session["Id_Num_UN"].ToString())
                            {
                                <option value="@item["id_num_un"]" selected>@item["Centros"]</option>
                            }

                        }
                        else
                        {
                            <option value="@item["id_num_un"]">@item["Centros"]</option>
                        }
                    }
                }

            </select>
        </div>
    </div>
    <div class="col-xs-4 col-md-4 col-lg-4">

    </div>
    <div class="col-xs-2 col-md-2 col-lg-2">
        <div class="text-right">
            @*<button type="button" class="btn btn-primary" onclick="popBuscador();">Buscador de Productos</button>*@
        </div>
    </div>
</div>
<div class="row" style="visibility:hidden; padding-bottom:50px;" id="divContent">
    <div class="col-xs-12 col-md-12 col-lg-12">
        <div class="ibox ">
            <div class="ibox-content">

                <div id="wizard">
                    <h3>Seleccionar Cliente</h3>
                    <section>
                        <div class="row" id="divVerificaCliente">
                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <div class="text-right">
                                    <button type="button" class="btn btn-primary" onclick="popBuscarClient();">Buscar Cliente</button>
                                    <button type="button" class="btn btn-primary" onclick="popAddClient();">Nuevo Cliente</button>
                                </div>
                                <p>
                                    <b>Identificaci&oacute;n del Cliente<br />Solicite al cliente cualquiera de los siguientes datos:</b>
                                    <ul>
                                        <li>Direcci&oacute;n de Correo Electr&oacute;nico</li>
                                        <li>N&uacute;mero Telef&oacute;nico(Capture sin Guiones)</li>
                                        <li>Si el Cliente no ha sido registrado con anterioridad debera darlo de alta</li>
                                    </ul>
                                </p>
                                <div class="input-group">
                                    <input type="text" id="txtVerificaC" value="" placeholder="CARACTERES VALIDOS:letras, n&uacute;meros, arroba(&#64;), gui&oacute;n medio(-) y bajo(_)" class="form-control"> <span class="input-group-append">
                                        <button type="button" class="btn btn-primary" onclick="VerificaCliente()">
                                            Verificar
                                        </button>
                                    </span>
                                </div>
                                <hr />
                            </div>
                        </div>

                        <div class="row" id="divResultClient" style="display:none;">
                            <div class="col-xs-4 col-md-4 col-lg-4"></div>
                            <div class="col-xs-4 col-md-4 col-lg-4">
                                <input type="hidden" id="hddIdCliente" />
                                <input type="hidden" id="hddIdDirCteUpd" />
                                <input type="hidden" id="hddCodBarFlete" />
                                <table style="width:100%" class="table table-warning">
                                    <tr>
                                        <td>Nombre:</td>
                                        <td><b id="lblNombreCte"></b></td>
                                    </tr>
                                    <tr>
                                        <td>Folio del Cliente:</td>
                                        <td>
                                            <p id="lblFolioCte"></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Correo Electr&oacute;nico:</td>
                                        <td>
                                            <p id="lblClaveCte"></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Tarjeta Lealtad:</td>
                                        <td>
                                            <p id="lblTarjetaLealtad"></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Direcci&oacute;n:</td>
                                        <td>
                                            <p id="lblCalleCte"></p>
                                            <p id="lblColoniaCte"></p>
                                            <p id="lblEdoCte"></p>
                                            <p id="lblCpCte"></p>


                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Tel&eacute;fono:</td>
                                        <td><p id="lblTelefonoCte"></p></td>
                                    </tr>
                                </table>
                            </div>

                            <div class="col-xs-2 col-md-2 col-lg-2">
                                <button type="button" class="btn btn-default btn btn-xs" onclick="NuevaBusqueda()">
                                    Nueva B&uacute;squeda
                                </button>
                                <button type="button" class="btn btn-default btn btn-xs" onclick="popEditarCte()">
                                    Editar Cliente
                                </button>
                            </div>
                            <div class="col-xs-2 col-md-2 col-lg-2">

                            </div>
                        </div>

                    </section>
                    <h3>Fecha de Entrega</h3>
                    <section>
                        <p><b>*Recuerda al cliente que nuestro horario de entrega es de 8:00 am a 10:00 pm de lunes a domingo, seleciona el d&iacute;a y hora que indique el cliente </b></p>
                        <div class="row">
                            <div class="col col-xs-12 col-md-12">
                                <div class="form-group">
                                    <label>D&iacute;a</label>
                                    <select class="form-control m-b" id="ddlDias" onchange="onchangeDias()">
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col col-xs-12 col-md-12">
                                <div class="form-group">
                                    <label>Entre</label>
                                    <select class="form-control m-b" id="ddlHoras">
                                    </select>
                                </div>
                            </div>
                        </div>
                    </section>
                    <h3>Carrito de Compras</h3>
                    <section>
                        @*<input id="flagCarrito" name="flagCarrito" value="1" style="visibility:hidden" />*@
                        <div class="row">
                            <div class="col-8">
                                <div class="alert alert-success" id="divOkArtHistorial">
                                    @* How quickly daft jumping zebras vex. <a class="alert-link" href="#">Alert Link</a>.*@
                                    Los arituclos de la orden se cargaron al carrito con &eacute;xito.
                                </div>
                            </div>
                            <div class="col-4">
                                @*<button type="button" onclick="seleccionarProducto()" class="btn btn-xs btn-danger btn-circle"><i class="fa fa-plus"></i></button>*@
                                <button type="button" class="btn btn-primary" onclick="seleccionarProducto();">Agregar Articulo</button>
                                <button type="button" id="btnHistoria" class="btn btn-primary" onclick="popHistorial()">
                                    Historial
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <table id="tblPoductosSeleccionados" class="table table-striped table-bordered table-hover">
                                    <thead class="bg-warning">
                                        <tr role="row">

                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1">Descripci&oacute;n</th>
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1" style="width:10%;">Precio Normal</th>
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1" style="width:10%;">Precio Oferta</th>
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1" style="width:20%;">Cantidad</th>
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1" style="width:20%;">Unidad de Venta</th>
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1" style="width:15%;">Total</th>
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1" style="width:30%;">Comentario</th>
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1" style="width:30%;">Sustituto</th>
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="1" style="width:10%;">Borrar</th>
                                        </tr>
                                    </thead>
                                    <tbody id="feedback2">
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-12">
                                <strong>  <label style="font-size:17px" id="lblCantidad"></label></strong>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-12">
                                <strong>  <label style="font-size:17px" id="lblDescuento"></label></strong>
                            </div>
                            <div class="col-sm-12 col-md-12 col-lg-12">
                                <strong> <label style="font-size:17px" id="lblTotal"></label> </strong>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <table id="tblBusquedaArt" class="table table-striped table-bordered table-hover" style="width:100%;">
                                    <thead class="bg-warning">
                                        <tr role="row">
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="2">Observaciones e instrucciones generales</th>
                                        </tr>
                                    </thead>
                                    <tbody id="Obs">
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td><input type="text" id="ObservacionesGrles" class="form-control input-sm" /></td>
                                            <td>
                                                <button type="button" id="btnHistoria" class="btn btn-primary" onclick="agregarObs()">
                                                    Agregar Observaciones
                                                </button>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </section>
                    <h3>Metodo de Entrega</h3>
                    <section>
                        <div class="row">
                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="rdoMetodoEntrega" id="rdoTda" value="1">
                                    <label class="form-check-label" for="flexRadioDefault1">
                                        ENTREGA EN TIENDA (Si el cliente elige acudir por su pedido selecciona esta opci&oacute;n)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="rdoMetodoEntrega" id="rdoDomicilio" value="2">
                                    <label class="form-check-label" for="flexRadioDefault2">
                                        ENTREGA A DOMICILIO (Confirma la Direcci&oacute;n del cliente o ingresa una nueva)
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-3 col-md-3 col-lg-3">
                                <input type="hidden" id="hddIdDir" />
                                <table>
                                    <tr>
                                        <td>
                                            <b>Nombre de la persona que recibira el pedido</b>
                                            <input type="text" id="rec_name" class="form-control input-sm" required />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>C&oacute;digo Postal</b>
                                            <input type="number" maxlength="5" id="rec_CP" class="form-control" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Ciudad</b>
                                            <input type="text" id="rec_ciudad" class="form-control input-sm" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Estado</b>
                                            @*<input type="text" id="rec_estado" class="form-control input-sm" />*@
                                            <select id="ddlRec_Estado" class="form-control"></select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Calle</b>
                                            <input type="text" id="rec_calle" class="form-control input-sm" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>N&uacute;mero</b>
                                            <input type="text" id="rec_num" class="form-control input-sm" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>N&uacute;mero Interior(si aplica)</b>
                                            <input type="text" id="rec_nunInt" class="form-control input-sm" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Colonia</b>
                                            <input type="text" id="rec_col" class="form-control input-sm" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <b>Tel&eacute;fono</b>
                                            <input type="text" id="rec_tel" class="form-control input-sm" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-xs-9 col-md-9 col-lg-9">
                                <table class="table" id="tblDirecciones">
                                    <tbody>
                                    </tbody>
                                </table>
                                @*<p>
                                        Juan Perex<br />
                                        Villas de Belgica 277<br />
                                        Colonia Roble nuevo<br />
                                        Escobedo<br />
                                        CP: 092890
                                        <br />
                                        <button type="button" class="btn btn-default btn btn-xs" onclick="GetTdasTrasp()">
                                            Utilizar esta direccón
                                        </button>
                                    </p>*@


                            </div>
                        </div>
                    </section>
                    <h3>Forma de Pago</h3>
                    <section>
                        <div class="row">
                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <span class="h5 font-bold m-t block text-right" id="lblTotalFormaP"></span>
                                <table id="tblFormaPago" class="table table-striped table-bordered table-hover" style="width:100%;">
                                    <thead class="bg-warning">
                                        <tr role="row">
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="2">Pago Contra Entrega</th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="rdoMetodoPago" id="rdoEfevo" value="efectivo" checked>
                                                    <label class="form-check-label" for="flexRadioDefault2">
                                                        Efectivo y/o vales de papel de despensa
                                                    </label>
                                                </div>
                                            </td>
                                            <td style="text-align:left;">
                                                @*Efectivo: <input type="text" id="in_pago" disabled value="0.00" width="100px;" oninput="input(this)" /><br />*@
                                                Efectivo: <input type="text" id="in_pago" disabled value="0.00" width="100px;" onfocus="if(this.value !== '') {this.value=''}" onblur="blurDecimal(this)" onkeypress='return isNumberKey(event,this,3,0)' autocomplete="off" /><br />
                                                @*Vales:&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" disabled value="0.00" oninput="input(this)" id="in_vales" width="100px;" />*@
                                                Vales:&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" disabled value="0.00" onfocus="if(this.value !== '') {this.value=''}" onblur="blurDecimal(this)" onkeypress='return isNumberKey(event,this,3,0)' id="in_vales" width="100px;" autocomplete="off" />
                                            </td>
                                        </tr>
                                        @*<tr>
                                                <td>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="rdoMetodoPago" id="rdoCdto" value="credito" checked>
                                                        <label class="form-check-label" for="flexRadioDefault2">
                                                            Tarjeta de Credito Terminal Portatil
                                                        </label>
                                                    </div>
                                                </td>
                                                <td></td>
                                            </tr>*@
                                        <tr>
                                            <td>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="rdoMetodoPago" id="rdoDebito" value="debito" checked>
                                                    <label class="form-check-label" for="flexRadioDefault2">
                                                        Tarjeta de D&eacute;bito/Cr&eacute;dito Terminal Portatil
                                                    </label>
                                                </div>
                                            </td>
                                            <td></td>
                                        </tr>
                                    </tbody>

                                </table>
                            </div>
                        </div>
                    </section>
                    <h3>Resumen</h3>
                    <section>
                        <div class="row">
                            <div class="col-xs-12 col-md-12 col-lg-12">
                                <table id="tblResumen" class="table table-striped table-bordered table-hover" style="width:100%;">
                                    <thead class="bg-warning">
                                        <tr role="row">
                                            <th class="text-center sorting">Descripci&oacute;n</th>
                                            <th class="text-center sorting">Cantidad</th>
                                            <th class="text-center sorting">Unidad de Venta</th>
                                            <th class="text-center sorting">Precio</th>
                                            <th class="text-center sorting">Subtotal</th>
                                            <th class="text-center sorting">Comentarios</th>
                                            <th class="text-center sorting">Sustituto</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>

                                </table>
                                @*<div class="col-xs-12 col-md-12 col-lg-12">*@
                                <table id="tblObervacionesResumen" class="table table-striped table-bordered table-hover" style="width:100%;">
                                    <thead class="bg-warning">
                                        <tr role="row">
                                            <th class="text-center sorting" tabindex="0" rowspan="1" colspan="2">Observaciones e instrucciones generales</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ObsResumen">
                                    </tbody>

                                </table>
                                @*</div>*@
                                <p> <strong> <label style="font-size:17px" id="lblDescuentoR"></label> </strong></p>
                                <p></p> <strong> <label style="font-size:17px" id="lblTotalR"></label> </strong></p>

                                <table class="table">
                                    <tr>
                                        <td><b>Ser&aacute; entregada en:</b></td>
                                        <td>
                                            <p id="lblMetodoEntrega">
                                            </p>
                                            <p><b id="lblNomDir"></b></p>
                                            <p id="lblDirEnt"> </p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><b>Fecha de entrega:</b></td>
                                        <td><p id="lblFecEnt"></p> </td>
                                    </tr>
                                    <tr>
                                        <td><b>Forma de Pago:</b></td>
                                        <td><p id="lblFormaPago"></p> </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </section>
                </div>

            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-xl" id="popUpSeleccionarProductos" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel2">B&uacute;squeda de Productos</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @*<div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <table id="tblBusquedaSeleccionar" class="table table-striped table-bordered table-hover">
                                <thead class="bg-danger-sor">
                                    <tr role="row">
                                        <th>Código</th>
                                        <th>Descripción</th>
                                        <th>Marca</th>
                                        <th>Precio</th>
                                        <th>Normal</th>
                                        <th>Dscto</th>
                                        <th></th>
                                        <th>Cantidad</th>
                                            <th name="accion">Acción</th>
                                    </tr>
                                </thead>
                                <tbody id="feedback"></tbody>
                            </table>
                        </div>

                    </div>*@

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                @*<button type="button" class="btn btn-primary" onclick="addProduct2()" data-dismiss="modal">Agregar</button>*@
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-xl" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">B&uacute;squeda de Productos</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <table id="tblBusquedaArt2" class="table table-striped table-bordered table-hover">
                            <thead class="bg-danger-sor">
                                <tr role="row">
                                    <th>C&oacute;digo</th>
                                    <th>Descripci&oacute;n</th>
                                    <th>Marca</th>
                                    <th>Precio</th>
                                    <th>Normal</th>
                                    <th>Dscto</th>
                                    <th></th>
                                    @*<th>Cantidad</th>
                                        <th name="accion">Acción</th>*@
                                </tr>
                            </thead>
                            <tbody id="feedback"></tbody>
                        </table>
                    </div>
                    @*<div class="col-xs-2 col-md-2 col-lg-2">
                            <img id="imgProduct2" src="~/Content/images/theme/default_image_01.png" class="img-lg">
                        </div>*@
                </div>
                @*<div class="row">
                        <div class="col-4">
                            <div class="input-group">
                                <span class="input-group-addon" id="basic-addon2">Cantidad</span>
                                <input type="text" id="Addcantidad" name="Addcantidad" class="form-control" placeholder="Cantidad de producto" aria-describedby="basic-addon2">
                            </div>
                        </div>
                    </div>*@

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                @*<button type="button" class="btn btn-primary" onclick="addProduct2()" data-dismiss="modal">Agregar</button>*@
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-xl" id="dlgBuscadorCliente" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Buscador de Clientes</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row" id="divBuscaCliente">
                    <div class="col-xs-12 col-md-12 col-lg-12">
                        <p>
                            <b>Buscador de Clientes</b><br />Se puede buscar por nombre y apellido paterno y materno.Para buscar por telefono ingrese solo digitos.Para buscar por direcci&oacute;n captura
                            <b>Calle #,Colonia y Ciudad</b> usando comas como separador
                        </p>
                        <div class="input-group">
                            <input type="text" id="txtBuscarCte" placeholder="CARACTERES VALIDOS:letras, n&uacute;meros, arroba(&#64;), gui&oacute;n medio(-) y bajo(_)" class="form-control"> <span class="input-group-append">
                                <button type="button" class="btn btn-primary" onclick="BuscarCliente('')">
                                    Buscar
                                </button>
                            </span>
                        </div>
                    </div>
                </div>
                <br />
                <div id="divgridClientes" style="display:none" class="col-sm-12 col-md-12 col-lg-12">
                    <table id="tblBusquedaCliente" class="table table-striped table-bordered table-hover">
                        <thead class="bg-danger-sor">
                            <tr role="row">
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Direcci&oacute;n</th>
                                <th>Tel&eacute;fono</th>
                                <th>Acci&oacute;n</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div id="divbuttonAddClient" style="display:none" class="col-sm-12 col-md-12 col-lg-12">
                    <p>
                        <b>No se encontraron resultados</b>
                    </p>
                    <button type="button" class="btn btn-primary" onclick="popAddClient();">Nuevo Cliente</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                @*<button type="button" class="btn btn-primary" data-dismiss="modal">Seleccionar</button>*@
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-lg" id="dlgAgregarProductoComentario" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Agregar Comentario al Producto</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        @*<input type="text" id="txtComentario" multiple />*@
                        <textarea id="txtComentario" cols="40" rows="5"></textarea>
                    </div>

                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="ConfirmarProduct()" data-dismiss="modal">Confirmar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-xl" id="dlgSeleccionar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Agregar Articulo</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xs-7 col-md-7 col-lg-7">
                        <div class="ibox">
                            <div class="ibox-title">
                                Buscador <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                        @*</a>*@
                                </div>
                            </div>
                            <div class="ibox-content">
                                <table style="width:100%;">
                                    <tr>
                                        <td>
                                            @*<input class="form-control" type="text" placeholder="Producto" value="" id="txtProdArt2">*@
                                            <form id="form1" runat="server">

                                                <input type="text" id="txtProdArt2" placeholder="Buscar..." class="form-control" autocomplete="off" />

                                                <div id="divTags" class="panel panel-default" style="position: absolute; z-index: 999; background: rgb(255, 255, 255);  height: 200px; width: 98%; overflow: auto; display: none;">
                                                    <table class="table">
                                                        <tbody id="output" style='cursor: pointer'>
                                                    </table>
                                                </div>

                                            </form>
                                        </td>
                                        <td style="text-align:center;">
                                            <button type="button" id="btnBuscar" class="btn btn-primary" onclick="CargaSeleccionaProducto('',1)">
                                                Buscar
                                            </button>
                                        </td>
                                        <td>
                                            <select id="ddlCategorias" onchange="CargaSeleccionaProducto('',2)" class="form-control m-b">
                                            </select>
                                            @*<button type="button" id="btnHistoria" class="btn btn-primary" onclick="clickLogin()">
                                                Historia
                                                </button>*@
                                            @*<input id="tags" class="ui-autocomplete-input" autocomplete="off">*@
                                        </td>
                                        <td>
                                            <select id="ddlMarcas" onchange="CargaSeleccionaProducto('',2)" class="form-control m-b">
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-md-12 col-lg-12">
                        <div class="alert alert-success" id="divOkArt">
                            @* How quickly daft jumping zebras vex. <a class="alert-link" href="#">Alert Link</a>.*@
                            El Articulo se ha agregado al carrito con &eacute;xito.
                        </div>
                        <div id="divLoading"></div>
                    </div>
                </div>
                <div class="row" id="tblBuscador">
                    @*<div id="tblBuscador"></div>*@
                    @*<div class="col-sm-12 col-md-12 col-lg-12">
                            <table id="tblBusquedaSeleccionar" class="table table-striped table-bordered table-hover">
                                <thead class="bg-danger-sor">
                                    <tr role="row">
                                        <th>Código</th>
                                        <th>Descripción</th>
                                        <th>Marca</th>
                                        <th>Precio</th>
                                        <th>Normal</th>
                                        <th>Dscto</th>
                                        <th></th>
                                        <th>Cantidad</th>
                                        <th>Unidad de Venta</th>
                                        <th name="accion">Acción</th>
                                    </tr>
                                </thead>
                                <tbody id="feedback"></tbody>
                            </table>
                        </div>*@
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                @*<button type="button" class="btn btn-primary" onclick="AddClient()" data-dismiss="modal">Agregar</button>*@
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-lg" id="dlgBuscador" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Alta de Cliente</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xs-5 col-md-5 col-lg-5">
                        <div class="ibox">
                            <div class="ibox-title">
                                Sucursales
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <table style="width:100%;">
                                    <tr>
                                        @*<td>
                                                <select class="form-control" id="cmbServicio" name="cmbServicio">
                                                    <option selected="selected" value="0">--Elegir Servicio--</option>
                                                    <option value="1">Cancelacion</option>
                                                    <option value="2">Retorno</option>

                                                </select>
                                            </td>*@
                                        <td><input class="form-control" type="number" min="1" max="99999" placeholder="C&oacute;digo Postal" value="" id="txtCp"></td>
                                        <td>
                                            <button type="button" id="btnTienda" class="btn btn-primary" onclick="cargaTdas();">
                                                Tienda
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>

                                        <td colspan="3">
                                            <select class="form-control" id="cmbTda" name="cmbTda">
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-7 col-md-7 col-lg-7">
                        <div class="ibox">
                            <div class="ibox-title">
                                Buscador  <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <table style="width:100%;">
                                    <tr>
                                        <td>
                                            <input class="form-control" type="text" placeholder="Producto" value="" id="txtProdArt">
                                        </td>
                                        <td style="text-align:center;">
                                            <button type="button" id="btnBuscar" class="btn btn-primary" onclick="CargaProducto()">
                                                Buscar
                                            </button>
                                        </td>
                                        <td>
                                            <button type="button" id="btnHistoria" class="btn btn-primary" onclick="clickLogin()">
                                                Historia
                                            </button>
                                        </td>
                                    </tr>

                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                @*<button type="button" class="btn btn-primary" onclick="AddClient()" data-dismiss="modal">Agregar</button>*@
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-lg" id="dlgAddClients" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Alta de Cliente</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xs-12 col-md-12 col-lg-12">
                        <div class="alert alert-warning" id="divMsjAddClient">
                            No se encontro ningun resultado para la busqueda. <b>Para dar de alta un nuevo cliente, llenar el siguiente formulario.</b>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-xs-6 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label>E-Mail </label>
                            <input type="email" id="txtCteEamil" placeholder="miemail@soriana.com" class="form-control" maxlength="100" />

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-6 col-md-6 col-lg-6">
                        <div class="form-group">
                            <label>Tarjeta Lealtad </label>
                            <input type="text" id="txtCteTarjetaLealtad" class="form-control" maxlength="100" />

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-4 col-md-4 col-lg-4">
                        <div class="form-group">
                            <label>Nombre </label>
                            <input type="text" id="txtCteNombre" class="form-control" maxlength="100" />
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-lg-3">
                        <div class="form-group">
                            <label>Apellido Paterno </label>
                            <input type="text" id="txtCteApPaterno" class="form-control" maxlength="100" />
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-lg-3">
                        <div class="form-group">
                            <label>Apellido Materno </label>
                            <input type="text" id="txtCteApMaterno" class="form-control" maxlength="100" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-3 col-md-3 col-lg-3">
                        <div class="form-group">
                            <label>Alias de la Direcci&oacute;n </label>
                            <input type="text" id="txtCteNomDir" class="form-control" maxlength="100" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-2 col-md-2 col-lg-2">
                        <div class="form-group">
                            <label>C&oacute;digo Postal </label>
                            <input type="text" id="txtCteCp" class="form-control" maxlength="5" min="0" />
                        </div>
                    </div>
                    <div class="col-xs-5 col-md-3 col-lg-4">
                        <div class="form-group">
                            <label>Estado </label>
                            <select id="ddlCteEstado" class="form-control" disabled></select>
                            @*<input type="text" id="ddlCteEstado" class="form-control" disabled maxlength="100" />*@
                        </div>
                    </div>
                    <div class="col-xs-5 col-md-3 col-lg-4">
                        <div class="form-group">
                            <label>Ciudad </label>
                            <input type="text" id="txtCteCiudad" class="form-control" disabled maxlength="100" />
                        </div>
                    </div>


                </div>
                <div class="row">
                    <div class="col-xs-3 col-md-3 col-lg-3">
                        <div class="form-group">
                            <label>Col&oacute;nia </label>
                            @*<input type="text" id="txtCteColonia" class="form-control" maxlength="100" />*@
                            <select id="ddlCteColonia" class="form-control">
                            </select>
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-lg-3">
                        <div class="form-group">
                            <label>Calle </label>
                            <input type="text" id="txtCteCalle" class="form-control" maxlength="100" />
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-lg-3">
                        <div class="form-group">
                            <label>N&uacute;mero Exterior </label>
                            <input type="text" id="txtCteNumExt" class="form-control" maxlength="100" />
                        </div>
                    </div>
                    <div class="col-xs-3 col-md-3 col-lg-3">
                        <div class="form-group">
                            <label>N&uacute;mero Interior </label>
                            <input type="text" id="txtCteNumInt" class="form-control" maxlength="100" />
                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class="col-xs-3 col-md-3 col-lg-3">
                        <div class="form-group">
                            <label>Tel&eacute;fono </label>
                            <input type="text" id="txtCteTelefono" class="form-control" maxlength="100" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="AddClient()">Agregar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-xl" id="dlgListClients" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Busqueda de Cliente</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12 col-md-12 col-lg-12">
                        <table id="tblConsultaCte" class="display table table-striped table-bordered table-hover table-responsive-md expand dataTable no-footer ">
                            <thead class="bg-danger-sor">
                                <tr>
                                    <th>Nombre</th>
                                    <th>Apellido Paterno</th>
                                    <th>Apellido Materno</th>
                                    <th>Email</th>
                                    <th>Tel&eacute;fono</th>
                                    <th>Direcci&oacute;n</th>
                                    <th name="accion"></th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="AddClient()" data-dismiss="modal">Agregar</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-xl" id="dlgHistorial" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Historial del Cliente</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row" id="divHistorialOrd">
                    <div class="col-xs-12 col-md-12 col-lg-12">
                        <table class="table table-striped table-bordered table-hover" id="tblHistorial">
                            <thead class="bg-danger-sor center-block">
                                <tr>
                                    <th>Orden</th>
                                    <th>Fecha</th>
                                    <th>Importe</th>
                                    <th>Puntos Obtenidos</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>

                    </div>
                </div>
                <div id="divHistorialDetalle">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    @*<button type="button" class="btn btn-primary" onclick="AddClient()" data-dismiss="modal">Agregar</button>*@
                </div>
            </div>
        </div>
    </div>
</div>


<input id="add_product" name="add_product" value="1" style="visibility:hidden" />
<input id="add_Obs" name="add_product" value="0" style="visibility:hidden" />
<input id="add_description" name="add_description" value="1" style="visibility:hidden" />
<input id="add_price" name="add_price" value="1" style="visibility:hidden" />
<input id="add_price_dsco" name="add_price_dsco" value="1" style="visibility:hidden" />
<input id="TotalOrden" name="TotalOrden" value="0" style="visibility:hidden" />
<input id="TieneCobertura" name="TieneCobertura" value="0" style="visibility:hidden" />

@section scripts {

    @* <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>*@
    <script>
        $(document).ready(function () { //para que suba el cambio
            $("#txtProdArt2").on("keyup", function () {
                if (this.value.length > 3) {
                    $.ajax({
                        complete: function () { // Set our complete callback, adding the .hidden class and hiding the spinner.
                            document.getElementById("spinner").classList.remove("show"); //pasar
                            $("#imgSpiner").css("display", "none");
                        },
                        beforeSend: function () {
                            $("#imgSpiner").css("display", "block");
                            document.getElementById("spinner").classList.add("show");
                            $("#divTags").show();
                        },
                        type: "POST",
                        "url": "@Url.Action("AutoComplete", "CallCenter")",
                        data: JSON.stringify({
                            product: $("#txtProdArt2").val()
                            , tienda: $("#ddlTdas").val()
                        }),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            if (data.Success) {
                                if (data.data.length == 0) {
                                    $("#divTags").hide();
                                }
                                else {
                                    output = "";
                                    for (var i = 0; i < data.data.length; i++) {
                                        output += "<tr><td  class='select'><img width='50px' height='60px' src=" + data.data[i].UrlImg + " /></td> <td class='select' id='srch-" + data.data[i].Barcode + "'>" + data.data[i].Description + "</td></tr></br>";
                                    }
                                    $("#output").html(output);
                                }
                            }
                            else {
                                alert(data.Message);
                            }
                        },
                        error: function (errorMessage) {
                            $("#divTags").hide();
                            alert(errorMessage);
                        },
                    });
                }
                else {
                    $("#divTags").hide();
                }
            });

            $(document).on("click", ".select", function () {
                if ($(this).html() != "") {
                    var id = $(this).attr('id');
                    var barCode = id.split("-");

                    $("#txtProdArt2").val($(this).html());
                    CargaSeleccionaProducto(barCode[1],1)
                    $("#txtProdArt2").val('');
                }
                else {
                    $("#txtProdArt2").val('');
                }

                $("#divTags").hide();
            });
        });

    </script>

    <script>
        document.onreadystatechange = function () {
            if (document.readyState !== "complete") {
                document.getElementById(
                    "divContent").style.visibility = "hidden";
                //$("#imgSpiner").css("display", "block");
                //document.getElementById("spinner").classList.add("show");
            } else {
                //document.getElementById("spinner").classList.remove("show");
                //$("#imgSpiner").css("display", "none");
                document.getElementById(
                    "divContent").style.visibility = "visible";
            }
        };


    </script>

    <style>
        /* (A) FULL SCREEN WRAPPER */
        #spinner {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 9999;
            width: 100vw;
            height: 100vh;
            /*background: rgba(0, 0, 0, 0);*/
            transition: opacity 0.2s;
            backdrop-filter: blur(5px);
            background-color: rgba(255, 255, 255, 0.7) !important;
        }

            /* (B) CENTER LOADING SPINNER */
            #spinner img {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%);
            }

        /* (C) SHOW & HIDE */
        #spinner {
            visibility: hidden;
            opacity: 0;
        }

            #spinner.show {
                visibility: visible;
                opacity: 1;
            }
        /*        .required {
            position: absolute;
            margin-left: -10px;
            color: #FB0000;
            font-size: 15px;
        }*/
    </style>
    <link href="~/Content/Inspinia/Styles/steps/jquery.steps.css" rel="stylesheet" />
    <script src="~/Content/Inspinia/plugins/steps/jquery.steps.min.js"></script>

    <script>



        var _jsonProductsSelected = [];
        var _jsonObservaciones = [];
        var _countObservaciones = 1;
        var _descripcion = undefined;
        var _barcode = undefined;
        var _precio = undefined;
        var _cantidad = undefined;
        var _Sku = undefined;
        var _descuento = 0;
        var _precioO = 0;
        var _SalesUnit = "";
        var _Sustituto = "";
        var _UnitConv=""
        var  _baseUnit = "";
        var  _equivalentUnit = "";
        var  _factorConversion = "0";




        $(document).ready(function () {

            $('#txtProdArt2').on('keypress', function (e) {
                if (e.which === 13) {
                    event.preventDefault();
                    ////Disable textbox to prevent multiple submit
                    //$(this).attr("disabled", "disabled");
                    CargaSeleccionaProducto('', 1)
                    ////Do Stuff, submit, etc..

                    ////Enable the textbox again if needed.
                    //$(this).removeAttr("disabled");
                    $('#txtProdArt').focus();
                }
            });
            setTimeout(function () {
                $("#divOkArtHistorial").fadeOut(1500);
            }, 2000);

            setTimeout(function () {
                $("#divOkArt").fadeOut(1500);
            }, 2000);
            //GetCategorias();

            GetEstados();

            $("#txtCteCp").keydown(function (event) {	// Allow backspace and delete
                if (event.keyCode == 46 || event.keyCode == 8) { } else {	   // Ensure that it is a number
                    if (event.keyCode < 48 || event.keyCode > 57) { event.preventDefault(); }
                }
            });
            $('#txtCteCp').keypress(function () {
                var maxLength = $(this).val().length;
                if (maxLength >= 5) {
                    //alert('You cannot enter more than ' + maxLength + ' chars');
                    return false;
                }
            });

            $("#txtCteCp").on("input", function (e) {
                var input = $(this);
                var val = input.val();

                if (input.data("lastval") != val) {
                    input.data("lastval", val);

                    if (val.length == 5) {
                        GetCp($("#txtCteCp").val());
                    }
                    //your change action goes here
                    console.log(val);
                }

            });

            $('#txtCteCp').keyup(function (e) {
                if (e.keyCode === 13) {
                    if ($("#txtCteCp").val().length == 5) {
                        GetCp($("#txtCteCp").val());

                    } else {
                        alert("La longitud del C.P. debe de ser de 5 caracteres");
                        $("#txtCteCp").focus();
                        return false;

                    }
                }
            });






            $('#tblBusquedaArt2 thead tr').clone(true).appendTo('#tblBusquedaArt2 thead');
            $('#tblBusquedaArt2 thead tr:eq(0) th').each(function (i) {
                if ($(this).attr('name') != "accion") {
                    var title = $(this).text();
                    $(this).html('<input type="text"  placeholder="' + title + '" />');

                    $('input', this).on('keyup change', function () {
                        if (table1.column(i).search() !== this.value) {
                            table1
                                .column(i)
                                .search(this.value)
                                .draw();
                        }
                    });
                } else {
                    $(this).empty();
                }

                $('input', this).on('keyup change', function () {
                    if (table1.column(i).search() !== this.value) {
                        table1
                            .column(i)
                            .search(this.value)
                            .draw();
                    }
                });
            });

            var table1 = $("#tblBusquedaArt2").DataTable(
                {
                    dom: "<'row'<'col col-xs-6'B><'#topRightSection.col-xs-12 col-md-6 text-right' f>>" +
                        "<'row'<'col-sm-12'tr>>" +
                        "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'lp>>",
                    processing: true,
                    ordering: true,
                    order: [[1, 'asc']],
                    filter: false,
                    info: false,
                    stateSave: false,
                    select: true,
                    select: {
                        style: 'single'
                    },
                    //Paggin
                    paging: true,
                    pageLength: 10,
                    lengthMenu: [10, 25, 50, 100, 500],

                    // destroy: true, //destruye automaticamente la referencia a la tabla
                    //Ajax
                    //serverSide: true,
                    //bServerSide: true,
                    //sServerMethod: "GET",
                    buttons: [],
                    orderCellsTop: false,
                    fixedHeader: true,
                    "scrollX": true,
                    "scrollY": true


                }
            );






            $('#tblHistorial').DataTable({
                "order": []
                //, columnDefs: [
                //    { className: 'text-right', targets: [2, 3] },
                //    { className: 'text-center', targets: [0] }
                //]
            });

            $("#wizard").steps({
                    supressPaginationOnFocus: false,
                labels: {
                    current: "current step:",
                    pagination: "Pagination",
                    finish: "Confirmar Orden",
                    next: "Siguiente",
                    previous: "Atras"

                },
                headerTag: "h3",
                bodyTag: "section",
                transitionEffect: "slideLeft",
                autoFocus: true,
               // stepsOrientation: "vertical",
                 onStepChanging: function (event, currentIndex, newIndex)
                {
                     var ok = false;


                   /*  alert(currentIndex);*/


                    //busqueda de cliente
                    if (currentIndex == 0 )
                    {
                        var _tienda = $("#ddlTdas").val();


                        if (_tienda == '0') {
                            alert("Debe seleccionar la tienda");
                           
                            return false;

                        }

                        //alert('Index ' + currentIndex);
                        var id = $("#hddIdCliente").val();
                        //var id = 1;
                        if (id.length == 0) {
                            return false;
                        }

                        var t = Date.now();
           
                         $.ajax({
                            async: false,
                            type: "GET",
                            url: '@Url.Action("GetDias", "CallCenter")',
                            data: {
                                //fechaOriginal: t
                            },
                            datatype: "html",
                            success: function (json) {

                                if (json.Success)
                                {
                                    var sel = $("#ddlDias");
                                    sel.empty();

                                    for (var i = 0; i < json.json.length; i++) {
                                        sel.append('<option value="' + json.json[i].fecha + '">' + json.json[i].NombeDia + '</option>');
                                    }

                                    var sel2 = $("#ddlHoras");
                                    sel2.empty();

                                    for (var i = 0; i < json.horas.length; i++) {
                                        sel2.append('<option value="' + json.horas[i].fecha + '">' + json.horas[i].NombeDia + '</option>');
                                    }

                                    ok = true;
                            }
                        }
                        , error: function (jqXHR, textStatus, errorThrown) {
                             bootbox.alert(errorThrown);

                        }
                         });

                        return ok;
                     }

                     //regresar a busqueda
                     if (currentIndex == 1 && newIndex == 0) {

                         return true;
                     }


                    //AVANZA  FECHA DE ENTREGAS
                     if (currentIndex == 1 && newIndex==2) {
                         var hrs = $("#ddlHoras").val();
                         if (hrs == null) {
                             alert("No hay horario disponible para " + $("#ddlDias option:selected").text());
                             return false;
                         }
                        return true;
                    }



                    //REGRESA A FECHA DE ENTREGAS
                    if (currentIndex == 2 && newIndex==1) {
                        return true;
                    }
                    //AVANZA METODO DE ENTREGA
                     if (currentIndex == 2 && newIndex == 3) {

                         var table = $('#tblPoductosSeleccionados').DataTable();
                         if (!table.data().count()) {
                             return false;
                         }

                        GetDirCteIdNumCte();
                        return true;
                    }

                    //REGRESA  CARRITO DE COMPRAS
                     if (currentIndex == 3 && newIndex == 2) {

                         var codf = $("#hddCodBarFlete").val();
                         if (codf.length != 0) {
                             if (codf != "0") { DeleteProduct(codf) };
                         }
                        return true;
                    }
                    //AVANZA A REGRESA A Metodo de entrega
                    if (currentIndex == 3 && newIndex == 4) {

                        var op = $("input:radio[name=rdoMetodoEntrega]:checked").val();

                        if (op == null) {
                            alert("Debe de seleccionar un metodo de entrega");
                            return false;
                        }

                        //EN TIENDA
                        if (op == "1") {
                           //limpiamos todos los valores de direccion de entrega
                            $("#hddIdDir").val('');
                            $("#rec_name").val('');
                            $("#rec_ciudad").val('');
                            $("#ddlRec_Estado").val('0');
                            $("#rec_calle").val('');
                            $("#rec_num").val('');
                            $("#rec_nunInt").val('');
                            $("#rec_col").val('');
                            $("#rec_CP").val('');
                            var codf = $("#hddCodBarFlete").val();
                            if (codf.length != 0) {
                                if (codf != "0") { DeleteProduct(codf) };
                            }
                            $("#hddCodBarFlete").val('0');



                            return true;
                        }
                        //DOMICILIO
                        if (op == "2") {

                            //$("#hddIdDir").val('');
                            if ($("#rec_name").val().length == 0) {
                                //$("[required]").after("<span class='required'>*</span>");
                                alert('Favor de capturar Nombre de la persona que recibira el pedido');
                                $("#rec_name").focus();
                                return false;
                            }

                            if ($("#rec_ciudad").val().length == 0) {
                                //$("[required]").after("<span class='required'>*</span>");
                                alert('Favor de capturar Ciudad');
                                $("#rec_ciudad").focus();
                                return false;
                            }
                            if ($("#ddlRec_Estado").val().length == 0) {
                                //$("[required]").after("<span class='required'>*</span>");
                                alert('Favor de capturar Estado');
                                $("#ddlRec_Estado").focus();
                                return false;
                            } if ($("#rec_calle").val().length == 0) {
                                //$("[required]").after("<span class='required'>*</span>");
                                alert('Favor de capturar Calle');
                                $("#rec_calle").focus();
                                return false;
                            } if ($("#rec_num").val().length == 0) {
                                //$("[required]").after("<span class='required'>*</span>");
                                alert('Favor de capturar Número');
                                $("#rec_num").focus();
                                return false;
                            } if ($("#rec_col").val().length == 0) {
                                //$("[required]").after("<span class='required'>*</span>");
                                alert('Favor de capturar Colonia');
                                $("#rec_col").focus();
                                return false;
                            }
                            if ($("#rec_CP").val().length == 0) {
                                //$("[required]").after("<span class='required'>*</span>");
                                alert('Favor de capturar Código Postal');
                                $("#rec_CP").focus();
                                return false;
                            }

                            //alert("Aqui nos traemos el valor del flete");
                            //Obtenemos el Flete
                            var _StoreNum = $("#ddlTdas").val();
                            var _CodigoPostal = $("#rec_CP").val();
                              $.ajax({
                                    async: false,
                                    type: "GET",
                                    url: '@Url.Action("GetFlete", "CallCenter")',
                                    data: {
                                        StoreNum: _StoreNum,
                                        CodigoPostal: _CodigoPostal
                                    },
                                    datatype: "html",
                                    success: function (json) {
                                        //
                                        if (json.Success) {
                                            $("#TieneCobertura").val("1");
                                            $("#hddCodBarFlete").val(json.resp.Num_CodBarra);
                                            //addProduct3(descripcion, barcode, precio, sku, SalesUnit, precioO)
                                            AddFlete(json.resp.Desc_art, json.resp.Num_CodBarra
                                                , json.resp.CostoEnvio
                                                , json.resp.id_Num_Sku
                                                , json.resp.Cve_UnVta
                                                , json.resp.CostoEnvio
                                                , 1
                                                , ''
                                                , ''
                                                ,0
                                            )

                                            return true;
                                        }
                                        else {
                                            $("#TieneCobertura").val("0");
                                            alert(json.Message);
                                            return false;
                                        }
                                    }
                                    , error: function (jqXHR, textStatus, errorThrown) {
                                        alert(errorThrown);
                                        return false;
                                    }

                                });
                            if ($("#TieneCobertura").val() == "1") {
                                return true;
                            }
                            else {
                                return false;
                            }
                        }

                        return true;
                    }

                    //REGRESA A FORMA DE PAGO
                    if (currentIndex == 4 && newIndex == 3) {
                        return true;
                    }

                    //AVANZO A RESUMEN
                    if (currentIndex == 4 && newIndex == 5) {

                        if ($("input:radio[name=rdoMetodoEntrega]:checked").val() == "1") {
                            $("#lblMetodoEntrega").text("Entrega en Tienda: " + $("[id='ddlTdas'] option:selected").text());
                        } else {
                        //<p><b id="lblNomDir"></b></p>
                        //<p id="lblDirEnt"> </p>
                            $("#lblNomDir").text($("#rec_name").val());
                            var dir = $("#rec_calle").val() + ' ' + $("#rec_num").val();
                            if ($("#rec_nunInt").val().length>0) {
                                dir += ',No. Interior ' + $("#rec_nunInt").val();
                            }

                            dir += ',' + $("#rec_col").val() + ',' + $("#rec_ciudad").val() + ',' + $("#ddlRec_Estado option:selected").text(); + ' C.P.' + $("#rec_CP").val();

                            $("#lblDirEnt").text(dir);
                        }


                        //fecha entrega
                        var diaEnt = $("[id='ddlDias'] option:selected").text();
                        var horaEnt = $("[id='ddlHoras'] option:selected").text();
                        $("#lblFecEnt").text(diaEnt + ' en horario de ' + horaEnt);

                        //metodo de pago

                        var op = $("input:radio[name=rdoMetodoPago]:checked").val();

                        if (op == "efectivo") {
                            if ($("#in_pago").val().length == 0 && $("#in_vales").val()) {
                                alert("Debe ingresar una canitdad en Efectivo o Vales");
                                return false;
                            } else {
                                var totEfevo = parseFloat($("#in_pago").val()) + parseFloat($("#in_vales").val());
                                if ( ! totEfevo > 0) {
                                    alert("La cantidad de efectivo y vales no pude ser 0");
                                    return false;
                                }
                                var TotalOrden = $("#TotalOrden").val();
                                TotalOrden = parseFloat(TotalOrden).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                                if (totEfevo < TotalOrden) {
                                    alert("El total de Efectivo y Vales no puede ser menor al total de la orden  ");
                                    return false;
                                }
                            }

                        }

                        if (op == "efectivo") {
                            var text = " Efectivo: $" + $("#in_pago").val() + "- Vales: $" + $("#in_vales").val() ;
                            $("#lblFormaPago").text("Efectivo y / o vales de papel de despensa " + text);
                        }
                        if (op == "credito") {
                            $("#lblFormaPago").text("Tarjeta de Credito Terminal Portatil")
                        }
                        if (op == "debito") {
                            $("#lblFormaPago").text("Tarjeta de Debito Terminal Portatil")
                        }


                        return true;
                    }

                     if (currentIndex == 5 && newIndex == 4) {
                         return true;
                     }


                    }
                ,onFinished: function (event, currentIndex) {
                    Finalizar();
                }
            });

            $("[name=btn]").click(function () {
                alert('click')
                $(this).parents("tr").remove();
            });


            $('#tblPoductosSeleccionados').dataTable({
                "order": []
            });
        });

        function ddlSustito(obj) {
            alert(obj.value);
            var value = obj.value;
            obj.val = value;
        }

        function toggleButton(buttonId, enable) {
            if (enable) {
                // Enable disabled button
                var button = $("#wizard").find('a[href="#' + buttonId + '-disabled"]');
                button.attr("href", '#' + buttonId);
                button.parent().removeClass();
            }
            else {
                // Disable enabled button
                var button = $("#wizard").find('a[href="#' + buttonId + '"]');
                button.attr("href", '#' + buttonId + '-disabled');
                button.parent().addClass("disabled");
            }
        }

        $(function () {
            $('input:radio[name="rdoMetodoPago"]').change(function () {
                if ($(this).val() == 'efectivo') {
                    $("#in_pago").val('0.00');
                    $("#in_vales").val('0.00');
                    $("#in_pago").prop('disabled', false);
                    $("#in_vales").prop('disabled', false);

                } else {
                    $("#in_pago").val('0.00');
                    $("#in_vales").val('0.00');
                    $("#in_pago").prop('disabled', true);
                    $("#in_vales").prop('disabled', true);
                }
            });
        });

        var delayTimer;
        function input(ele) {
            clearTimeout(delayTimer);
            delayTimer = setTimeout(function () {
                if (ele.value == "") {
                    ele.value = 0;
                }
                ele.value = parseFloat(ele.value).toFixed(2).toString();
            }, 2200);
        }

        function inputCar(ele) {
            clearTimeout(delayTimer);
            delayTimer = setTimeout(function () {
                if (ele.value == "") {
                    ele.value = 0;
                } else {
                    //alert(ele.value);
                    //alert(parseFloat(ele.value).toFixed(2).toString().length);
                    if (parseFloat(ele.value).toFixed(3).toString().length > 8 ) {
                        ele.value = 1;
                    }
                }


                ele.value = parseFloat(ele.value).toFixed(3).toString();
            }, 2200);
        }

        function Finalizar() {

            toggleButton("finish", false);
            var products = new Array();
            var observaciones = new Array();

            for (var i = 0; i < _jsonProductsSelected.length; i++) {
                var product = {};
                product.Id_Num_Sku = _jsonProductsSelected[i].sku;
                product.Num_CodBarra = _jsonProductsSelected[i].barcode;
                product.Precio_VtaNormal = _jsonProductsSelected[i].price;
                product.Desc_art = _jsonProductsSelected[i].description;
                product.Cant_Unidades = _jsonProductsSelected[i].quantity;
                if (_jsonProductsSelected[i].factorConversion != 0) {
                    product.Cve_UnVta = _jsonProductsSelected[i].UnitConv;
                }
                else {
                    product.Cve_UnVta = _jsonProductsSelected[i].SalesUnit;
                }
                //product.Precio_VtaNormal = row.find("TD").eq(3).html().replace('$','');
                product.Precio_VtaOferta = _jsonProductsSelected[i].precioO;
                product.Dcto = 0;//row.find("TD").eq(1).html();
                product.obs = _jsonProductsSelected[i].comment;
                product.Sustituto = _jsonProductsSelected[i].sustituto;
                product.Factor = _jsonProductsSelected[i].factorConversion;
                products.push(product);
            }

            //$("#tblResumen TBODY TR").each(function () {
            //    var row = $(this);
            //    var product = {};

            //    row.find("td:eq(0) input[type='hidden']").each(function () {
            //        var id=   $(this).attr('id');
            //        if (id.includes("sku"))
            //        {
            //            product.Id_Num_Sku = $(this).val();
            //        } else if (id.includes("codBar") )
            //        {
            //            product.Num_CodBarra = $(this).val();
            //        } else
            //        {
            //            product.Precio_VtaNormal = $(this).val();
            //        }
            //    })
            //    product.Desc_art = row.find("TD").eq(0).html().replace("'", '');
            //    product.Cant_Unidades = row.find("TD").eq(1).html();
            //    product.Cve_UnVta = row.find("TD").eq(2).html();
            //    //product.Precio_VtaNormal = row.find("TD").eq(3).html().replace('$','');
            //    product.Precio_VtaOferta = row.find("TD").eq(3).html().replace('$', '');
            //    product.Dcto = 0;//row.find("TD").eq(1).html();
            //    product.obs = row.find("TD").eq(5).html();
            //    product.Sustituto = row.find("TD").eq(6).html();
            //    products.push(product);
            //});

            $("#tblBusquedaArt TBODY TR").each(function () {
                var row1 = $(this);
                var observacion = {};


                observacion.Desc_CarObs = row1.find("TD").eq(0).html();
                observaciones.push(observacion);
            });

            var _idCliente = $("#hddIdCliente").val();
            var _diaEnt = $("#ddlDias").val();
            var _horaEnt = $("#ddlHoras").val();
            var _metodoEnt = $("input:radio[name=rdoMetodoEntrega]:checked").val()
            var _metodoPago = $("input:radio[name=rdoMetodoPago]:checked").val()
            var _efectivo = $("#in_pago").val();
            var _vales = $("#in_vales").val();
            var _tda = $("#ddlTdas").val();

            var Calle = $("#rec_calle").val();
            var Nom_DirCTe = $("#rec_name").val();
            var Num_Ext = $("#rec_num").val();
            var Num_Int = $("#rec_nunInt").val();
            var Ciudad = $("#rec_ciudad").val();
            var Cod_Postal = $("#rec_CP").val();
            var Colonia = $("#rec_col").val();
            var Telefono = $("#rec_tel").val();

            var Ids_Num_Edo = $("#ddlRec_Estado").val();
            var _idDirPrinCte = $("#hddIdDirCteUpd").val();

            //Send the JSON array to Controller using AJAX.
            $.ajax({
                type: "POST",
                url: '@Url.Action("FinalizarOrden", "CallCenter")',
                beforeSend: function () {
                    $("#imgSpiner").css("display", "block");
                    document.getElementById("spinner").classList.add("show");
                },
                complete: function () { // Set our complete callback, adding the .hidden class and hiding the spinner.
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");

                },
                data: JSON.stringify(
                    {
                        arts: products,
                        carObs:observaciones,
                        idCliente: _idCliente,
                        diaEnt: _diaEnt,
                        horaEnt: _horaEnt,
                        metodoEnt: _metodoEnt,
                        metodoPago: _metodoPago,
                        efectivo: _efectivo,
                        vales: _vales,
                        tda: _tda,

                        Calle: Calle,
                        Nom_DirCTe: Nom_DirCTe,
                        Num_Ext: Num_Ext,
                        Num_Int: Num_Int,
                        Ciudad: Ciudad,
                        Cod_Postal: Cod_Postal,
                        Colonia: Colonia,
                        Telefono: Telefono,
                        Ids_Num_Edo: Ids_Num_Edo,
                        idDirPrinCte:_idDirPrinCte
                    }
                ),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (r) {
                    if (r.Success) {
                        alert(r.Message);
                        location.reload();
                    } else {
                        alert(r.Message);
                        document.getElementById("spinner").classList.remove("show");
                        $("#imgSpiner").css("display", "none");
                        toggleButton("finish", true);
                    }
                }
                //, complete: function () {
                //    //Ajax request is finished, so we can enable
                //    //the button again.
                //    toggleButton("finish", true);
                //}
                , error: function (jqXHR, textStatus, errorThrown) {
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");
                    alert(errorThrown);

                }
            });
        }

        function cargaTdas() {

            if ($('#txtCp').val() == "") {
                $('#txtCp').focus();
                return;
            }
            $.ajax({
                        "url": "@Url.Action("TiendasCP", "CallCenter")",
                        "type": "get",
                        "data": { "cp": document.getElementById("txtCp").value },

                        "dataType": "json",
                        "success": function (data) {
                            var options = "";
                            $.each(data, function (index, value) {
                                options += '<option value="' + value.id + '">' + value.nombre + '</option>';
                            });
                            $("#cmbTda").html(options);

                            $("#cmbTda option[value=" + 0 + "]").attr("selected", true);
                            //$('#csdc_tipoequipo option:not(:selected)').attr('disabled', true);
                        }
                    });


        }

        function CargaSeleccionaProducto(param,op) {

            $("#divTags").hide();//
            if (param.length == 0) {//
                param = $("#txtProdArt2").val();//
            }

            if (param.length == 0) {//
                $("#txtProdArt2").focus();//
                return;//
            }//

            var tda = $("#ddlTdas").val()
            var categoria = $("#ddlCategorias").val();
            var marca = $("#ddlMarcas").val();

            if (categoria.length == 0) { categoria = '0' };
            if (marca.length == 0) { marca = '0' };

            if (op == 1) {
                categoria = '0';
                marca = '0';
            }

            $.ajax({

                "url": "@Url.Action("GetProduct", "CallCenter")",
                "type": "post",
                "data": {
                    product: param,
                    tienda: tda,
                    categoria: categoria,
                    marca: marca
                },
                "dataType": "json",
                "success": function (data) {
                    debugger;
                    if (data.Success) {


                        var sel = $("#ddlCategorias");
                        sel.empty();

                        $('#ddlCategorias').get(0).options[0] = new Option("--Todas las Categorias--", "0");
                        for (var i = 0; i < data.categ.length; i++) {
                            sel.append('<option value="' + data.categ[i] + '">' + data.categ[i] + '</option>');
                        }


                        var sel1 = $("#ddlMarcas");
                        sel1.empty();

                        $('#ddlMarcas').get(0).options[0] = new Option("--Todas las Marcas--", "0");
                        for (var i = 0; i < data.marcas.length; i++) {
                            sel1.append('<option value="' + data.marcas[i] + '">' + data.marcas[i] + '</option>');
                        }


                        $('#ddlCategorias').val(categoria);
                        $('#ddlMarcas').val(marca);

                        $('#ddlCategorias').attr('disabled', false);
                        $('#ddlMarcas').attr('disabled', false);

                        $("#tblBuscador").html(data.view);
                        var table = $("#tblBusquedaSeleccionar").DataTable(
                            {
                                language: {
                                    emptyTable: "(0) articulos encontrados",
                                },
                                processing: true,
                                ordering: true,
                                order: [],
                                filter: true,
                                info: false,
                                stateSave: false,

                                //Paggin
                                paging: true,
                                pageLength: 10,
                                lengthMenu: [10, 25, 50, 100, 500],

                                // destroy: true, //destruye automaticamente la referencia a la tabla
                                //Ajax
                                //serverSide: true,
                                //bServerSide: true,
                                //sServerMethod: "GET",
                                buttons: [],
                                orderCellsTop: false,
                                "scrollY": "400px",
                                "scrollCollapse": true,

                                //, "order": [[2, "asc"]]

                            }
                        );
                        $("#imgSpiner").css("display", "none");
                        document.getElementById("spinner").classList.remove("show");
                    }
                },
                 beforeSend: function () {
                    $("#imgSpiner").css("display", "block");
                    document.getElementById("spinner").classList.add("show");
                },
                complete: function () { // Set our complete callback, adding the .hidden class and hiding the spinner.
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");

                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    debugger;
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");
                    alert(errorThrown);

                }
                    });
        }

        function CargaProducto() {
            $("#dlgBuscador").modal("hide");
            if ($('#txtProdArt').val() == "") {
                $('#txtProdArt').focus();
                return;
            }

            $.ajax({
                        "url": "@Url.Action("GetProduct", "CallCenter")",
                        "type": "get",
                        "data": { "product": document.getElementById("txtProdArt").value },

                        "dataType": "json",
                        "success": function (data) {
                            var myTable = $('#tblBusquedaArt2').DataTable();
                            var nCant = 0;
                            myTable
                                .clear()
                                .draw();
                            for (var i = 0; i < data.data.length; i++) {


                                myTable.row.add([

                                    data.data[i].Barcode,
                                    data.data[i].Description,
                                    data.data[i].Company,
                                    data.data[i].Price,
                                    data.data[i].Price,
                                    data.data[i].PromotionalPrice,
                                    "<img width='100' height='100' id=\"imgProduct2\" src=\"" + data.data[i].UrlImage + "\" class=\"img-lg\">"
                                    //"<input type='number' id='nCant-" + data.data[i].Barcode + "' value='" + nCant + "' class='form-control input-sm' " + "" + " />",
                                    //"<button title='Agregar Producto' onclick='addProduct3(" + '$("nCant-' + data.data[i].Barcode + "\"))' type='button' class='btn btn-white btn-circle'> <i class='fa fa-check'></i></button>"
                                ]).draw();
                            }

                            $("#exampleModal").modal("show");

                            //$.each(data.data, function (index, value) {
                            //    $('#feedback').append("<tr><td>" + value.Barcode + "</td>"
                            //        + "<td>" + value.Description + "</td>"
                            //        + "<td>" + value.Company + "</td>"
                            //        + "<td>" + value.Price + "</td>"
                            //        + "<td>" + value.Price + "</td>"
                            //        + "<td>" + value.PromotionalPrice + "</td><td>"
                            //        + "<div class=\"col-xs-2 col-md-2 col-lg-2\">"
                            //        + "<img width='100' height='100' id=\"imgProduct2\" src=\" " + value.UrlImage + " \" class=\"img - lg\">"
                            //        + "</div>"
                            //        + "</td>"
                            //        + "<td>" + value.Price + "</td>"
                            //        + "<td>" + value.Price + "</td>"
                            //        + "</tr>");
                            //    document.getElementById("imgProduct2").src = value.UrlImage;
                            //});

                            //document.getElementById("add_product").value = data.data.Barcode;
                            //document.getElementById("add_description").value = data.data.Description;
                            //document.getElementById("add_price").value = data.data.Price;
                            //document.getElementById("add_price_dsco").value = data.data.PromotionalPrice;


                        }
            });

            $('#txtProdArt').focus();
        }

        function addProduct() {


            document.getElementById("txtProdArt").focus();
            document.getElementById('btnBuscar').disabled = false;
        }

        function DeleteProduct(barcode) {
            var cantidad = $("#productCant-" + barcode).val();
            var sus = $("#cSustituto-" + barcode).val();

            var item = _jsonProductsSelected.find(x => x.barcode === barcode);

            let _index = _jsonProductsSelected.indexOf(item);
            if (_index > -1) {
                _jsonProductsSelected.splice(_index, 1);
            }

            item.sustituto = sus;
            llenarCarrito();
        }

        function Change(barcode) {
            var cantidad = $("#productCant-" + barcode).val();
            var comentario = $("#comment-" + barcode).val();
            var sus = $("#cSustituto-" + barcode).val();
            var item = _jsonProductsSelected.find(x => x.barcode === barcode);
            var total = cantidad * item.precioO;


            if (cantidad == "0") {
                $("#productCant-" + barcode).val('1');

                $("#productCant-" + barcode).focus();
                return false;
            }

            var conversionRule = $("#umc-" + barcode).val();

            if (typeof conversionRule !== "undefined") {

                if (conversionRule == 'pza') {
                    var facCon = $("#facConvC-" + barcode).val();
                    total = (parseFloat(cantidad) / parseFloat(facCon).toFixed(2)) * item.precioO;
                }
                else {
                    total = cantidad * item.precioO;
                }
                item.SalesUnit = conversionRule;
            }
            else {
                conversionRule = "";
            }

            //console.log('item', item, "_jsonProductsSelected", _jsonProductsSelected, barcode);

            item.quantity = cantidad;
            item.total =total;
            item.comment = comentario;
            item.sustituto = sus;
            item.UnitConv = conversionRule;

            console.log(_jsonProductsSelected);

                llenarCarrito();
        }

        function Change_2(barcode) {
            var cantidad = $("#productCant-" + barcode).val();
            var comentario = $("#comment-" + barcode).val();
            var item = _jsonProductsSelected.find(x => x.barcode === barcode);
            var sus = $("#cSustituto-" + barcode).val();
            //console.log('item', item, "_jsonProductsSelected", _jsonProductsSelected, barcode);

            item.quantity = cantidad;
            item.total = cantidad * item.precioO;
            item.comment = comentario;
            item.sustituto = sus;

            console.log(_jsonProductsSelected);

            llenarCarrito();

        }

        function addProduct3(descripcion, barcode, precio, sku, SalesUnit, precioO, baseUnit, equivalentUnit,factorConversion) {

            var cantidad = $("#nCant-" + barcode).val();
            if (cantidad == 0) {
                alert("La Cantidad debe ser Mayor a 0.")
            }
            else {


                _UnitConv = "";
                var conversionRule = $("#um-" + barcode).val();

                if (typeof conversionRule !== "undefined") {

                    _UnitConv = conversionRule;
                }

                //parseFloat(document.getElementById(amtid4).innerHTML, 10).toFixed(2);
                _descripcion = descripcion.replace("|", "'"); //replaceall
                _barcode = barcode;
                _precio = parseFloat(precio).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                _cantidad = cantidad;
                _Sku = sku;
                _precioO = parseFloat(precioO).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                _SalesUnit = SalesUnit;
                _Sustituto = $("#bSustituto-" + barcode).val();

                _baseUnit = baseUnit;
                _equivalentUnit = equivalentUnit;
                _factorConversion = factorConversion;

                //$("#dlgAgregarProductoComentario").modal("show");
                ConfirmarProduct();
                //$("#dlgSeleccionar").modal("hide");

                $("#divOkArt").show();
                setTimeout(function () {
                    $("#divOkArt").fadeOut(1000);
                }, 1000);
            }


        }

        function AddFlete(descripcion, barcode, precio, sku, SalesUnit, precioO, cant, baseUnit, equivalentUnit, factorConversion) {




                _descripcion = descripcion.replace("|", "'"); //replaceall
                _barcode = barcode;
                _precio = parseFloat(precio).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                _cantidad = cant;
                _Sku = sku;
                _precioO = parseFloat(precioO).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                _SalesUnit = SalesUnit;
                _Sustituto = "No";
                _baseUnit = baseUnit;
                _equivalentUnit = equivalentUnit;
                _factorConversion = factorConversion;
                _UnitConv = "";

                if (factorConversion !== 0) {

                    _UnitConv = baseUnit;
                }

                var item = _jsonProductsSelected.find(x => x.barcode === _barcode);

                if (item != undefined) {
                    let _index = _jsonProductsSelected.indexOf(item);
                    if (_index > -1) {
                        _jsonProductsSelected.splice(_index, 1);
                    }
                }

                let _obj = {};
                _obj.barcode = _barcode;
                _obj.description = _descripcion;
                _obj.price = _precio;
                _obj.quantity = _cantidad;
                _obj.total = _cantidad * _precioO;
                _obj.comment = $("#txtComentario").val();
                _obj.sku = _Sku;
                _obj.SalesUnit = _SalesUnit;
                _obj.precioO = _precioO;
                _obj.sustituto = _Sustituto;
                _obj.baseUnit = _baseUnit;
                _obj.equivalentUnit = _equivalentUnit;
                _obj.factorConversion = _factorConversion;
                _obj.UnitConv = _UnitConv;
                _jsonProductsSelected.push(_obj);


                llenarCarrito();


        }

        function ConfirmarProduct() {

            var item = _jsonProductsSelected.find(x => x.barcode === _barcode);

            if (item != undefined) {
                let _index = _jsonProductsSelected.indexOf(item);
                if (_index > -1) {
                    _jsonProductsSelected.splice(_index, 1);
                }
            }

            var _total = 0;


            if (_factorConversion != 0 && _UnitConv=="pza")
            {
                _total = (parseFloat(_cantidad) / parseFloat(_factorConversion).toFixed(2)) * parseFloat(_precioO.replace(/,/g, ''));
            }
            else
            {
                _total = parseFloat(_cantidad) * parseFloat(_precioO.replace(/,/g, ''));
            }



            let _obj = {};
            _obj.barcode = _barcode;
            _obj.description = _descripcion;
            _obj.price = _precio;
            _obj.quantity = _cantidad;
            _obj.total = _total;
            _obj.comment = $("#txtComentario").val();
            _obj.sku = _Sku;
            _obj.SalesUnit = _SalesUnit;
            _obj.precioO = _precioO;
            _obj.sustituto = _Sustituto;
            _obj.UnitConv = _UnitConv;
            _obj.baseUnit = _baseUnit;
            _obj.equivalentUnit = _equivalentUnit;
            _obj.factorConversion = _factorConversion;


            _jsonProductsSelected.push(_obj);


            llenarCarrito();

            $("#txtComentario").val("");
            $("#dlgAgregarProductoComentario").modal("hide");
            $("#dlgSeleccionar").modal("show");
        }

        function llenarCarrito() {
            var cant = 0, tot = 0.0,descuento=0;

            var myTable = $('#tblPoductosSeleccionados').DataTable();



            let CurrentPageNo = myTable.page.info().page;

            myTable
                .clear()
                .draw();
            for (var i = 0; i < _jsonProductsSelected.length; i++) {

                var _salesUnite = _jsonProductsSelected[i].SalesUnit;
                var factorConversion = _jsonProductsSelected[i].factorConversion;

                if (factorConversion !== 0) {
                    var facCon = $("#facConvB-" + _jsonProductsSelected[i].barcode).val();
                    let optionFactorCon = "";

                    if (_jsonProductsSelected[i].UnitConv == _jsonProductsSelected[i].baseUnit) {
                        optionFactorCon = "<option selected value='" + _jsonProductsSelected[i].baseUnit + "' >" + _jsonProductsSelected[i].baseUnit + "</option>"
                        + "<option value='" + _jsonProductsSelected[i].equivalentUnit + "' >" + _jsonProductsSelected[i].equivalentUnit + "</option>";
                    } else {
                        optionFactorCon = "<option  value='" + _jsonProductsSelected[i].baseUnit + "' >" + _jsonProductsSelected[i].baseUnit + "</option>"
                        + "<option selected value='" + _jsonProductsSelected[i].equivalentUnit + "' >" + _jsonProductsSelected[i].equivalentUnit + "</option>";
                    }






                    _salesUnite = "<input type='hidden' value='" + factorConversion + "' id='facConvC-" + _jsonProductsSelected[i].barcode + "' />"
                        + " <select class='form-control' id='umc-" + _jsonProductsSelected[i].barcode + "' onchange='conversionRule(" + _jsonProductsSelected[i].barcode + ",2)'>"
                        + optionFactorCon
                        + "</select>"
                }

                var totaArt = Math.round(parseFloat(_jsonProductsSelected[i].total) * 100) / 100;
                var inp;
                if (_jsonProductsSelected[i].SalesUnit == 'pza') {
                    cant = cant + parseInt(_jsonProductsSelected[i].quantity);
                    inp = "<input  oninput='javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);' maxlength ='5'  onkeypress='return event.charCode >= 48' min='1' step='1' type='number' onchange='Change(\"" + _jsonProductsSelected[i].barcode + "\")' id='productCant-" + _jsonProductsSelected[i].barcode + "' value='" + _jsonProductsSelected[i].quantity + "' class='form-control input-sm' /> ";
                } else {
                    cant = cant + 1;
                    inp = "<input  onkeypress='return isNumberKey(event,this,4,9)'  min='1' step='1' type='number' onchange='Change(\"" + _jsonProductsSelected[i].barcode + "\")' id='productCant-" + _jsonProductsSelected[i].barcode + "' value='" + _jsonProductsSelected[i].quantity + "' class='form-control input-sm' /> ";
                }



                var _sustitutoOptions = "";

                if (_jsonProductsSelected[i].sustituto == "Si") {
                    _sustitutoSelecetd = "<option value='Si' selected>Si</option>"
                        + "<option value='No'>No</option>";
                } else {
                    _sustitutoSelecetd = "<option value='Si' >Si</option>"
                        + "<option value='No' selected>No</option>";
                }


                myTable.row.add([

                    _jsonProductsSelected[i].description,
                    "$" + _jsonProductsSelected[i].price,
                    "$" + _jsonProductsSelected[i].precioO,
                    "<div id='divUSC-" + _jsonProductsSelected[i].barcode+"'>"+ inp+"</div>",//"<input onkeypress='return event.charCode >= 48' min='1' type='number' onchange='Change(\"" + _jsonProductsSelected[i].barcode + "\")' id='productCant-" + _jsonProductsSelected[i].barcode + "' value='" + _jsonProductsSelected[i].quantity + "' class='form-control input-sm'  /> ",
                    _salesUnite,
                    //"$" + totaArt,
                    "$" + parseFloat(totaArt).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'),
                    "<input type='text'  onchange='Change(\"" + _jsonProductsSelected[i].barcode + "\")' id='comment-" + _jsonProductsSelected[i].barcode + "' value='" + _jsonProductsSelected[i].comment + "' class='form-control input-sm'  /> ",
                    "<select onchange='Change(\"" + _jsonProductsSelected[i].barcode + "\")' name='ddlDustituto' class='form-control' id='cSustituto-"+ _jsonProductsSelected[i].barcode +"'>"
                    + _sustitutoSelecetd
                    +"</select>",
                    "<button type='button'  onclick='DeleteProduct(\"" + _jsonProductsSelected[i].barcode + "\")'  class='btn btn-warning btn-circle'> <i class='fa fa-minus'></i></button>"
                ]).draw();

                if (factorConversion !== 0) {


                    if (_jsonProductsSelected[i].UnitConv == 'pza') {
                        descuento = descuento + ((parseFloat(_jsonProductsSelected[i].quantity) / parseFloat(factorConversion).toFixed(2)) * (parseFloat(_jsonProductsSelected[i].price) - parseFloat(_jsonProductsSelected[i].precioO)));
                    } else {
                        descuento = descuento + (_jsonProductsSelected[i].quantity * (parseFloat(_jsonProductsSelected[i].price) - parseFloat(_jsonProductsSelected[i].precioO)));
                    }
                }
                else {
                    descuento = descuento + (_jsonProductsSelected[i].quantity * (parseFloat(_jsonProductsSelected[i].price) - parseFloat(_jsonProductsSelected[i].precioO)));
                }
                //$("#cSustituto-" + _jsonProductsSelected[i].barcode).val(_jsonProductsSelected[i].sustituto);

                tot = tot + parseFloat(_jsonProductsSelected[i].total)



            }


            var myTable2 = $('#tblPoductosSeleccionados').DataTable();
            myTable2.page(CurrentPageNo).draw(false)
            var numb = roundToTwo(tot);
            tot = numb;
            //tot = parseFloat(tot).toFixed(3).replace(/\d(?=(\d{3})+\.)/g, '$&,');
            cant = parseFloat(cant).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
            descuento = parseFloat(descuento).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
            $("#lblCantidad").empty();
            $("#lblCantidad").append("Articulos Totales: " + _jsonProductsSelected.length);
            //$("#lblCantidad").append("Articulos Totales: " + cant);
            $("#lblDescuento").empty();
            $("#lblDescuento").append("Ahorro: $" + descuento);
            $("#lblTotal").empty();
            $("#lblTotal").append("Total a Pagar: $" + parseFloat(tot).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'));
            $("#TotalOrden").val(tot);
            $("#lblTotalFormaP").empty();
            $("#lblTotalFormaP").append("Total a Pagar: $" + parseFloat(tot).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'));




            var myTableR = $('#tblResumen').DataTable();
            myTableR
                .clear()
                .draw();

            for (var x = 0; x < _jsonProductsSelected.length; x++) {

                var totaArt = parseFloat(_jsonProductsSelected[x].total).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                var _SalesUnit = _jsonProductsSelected[x].SalesUnit;

                if (_jsonProductsSelected[x].UnitConv != "undefined") {
                    if (_jsonProductsSelected[x].UnitConv.length > 0) {
                        _SalesUnit = _jsonProductsSelected[x].UnitConv;
                    }
                }
                myTableR.row.add([
                         _jsonProductsSelected[x].description
                        +"<input type='hidden' id='sku-" + _jsonProductsSelected[x].sku + "' value='" + _jsonProductsSelected[x].sku + "'/>"
                        + "<input type='hidden' id='codBar-" + _jsonProductsSelected[x].barcode + "' value='" + _jsonProductsSelected[x].barcode + "'/>"
                        + "<input type='hidden' id='precioN-" + _jsonProductsSelected[x].barcode + "' value='" + _jsonProductsSelected[x].price + "'/>",
                        //proxima validacion de decimales fixed con base al salesunit
                        _jsonProductsSelected[x].quantity,
                        _SalesUnit,//_jsonProductsSelected[x].SalesUnit,
                        "$" + _jsonProductsSelected[x].precioO,
                        "$" + totaArt,
                        _jsonProductsSelected[x].comment,
                        _jsonProductsSelected[x].sustituto,
                    ]).draw();
            }

            $("#lblTotalR").empty();
            $("#lblTotalR").append("Costo Total de la Orden: $" + parseFloat(tot).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,'));

            $("#lblDescuentoR").empty();
            $("#lblDescuentoR").append("Ahorro Total de la Orden: $" + descuento);



        }

    function roundToTwo(num)
        {
            return +(Math.round(num + "e+2") + "e-2");
        }

        function llenarObservacionesResumen() {
            $('#ObsResumen').empty();
            for (var x = 0; x < _jsonObservaciones.length; x++) {

                $('#ObsResumen').append("<tr>"
                    + "<td>" + _jsonObservaciones[x].observacion + "</td>");
            }
        }

        function agregarObs() {
            var sum_Obs = $('#add_Obs').val();
        /*            var myTable = $('#tblBusquedaArt').DataTable();*/
            //if (document.getElementById("ObservacionesGrles").value != '') {
                let _obj = {};
                _obj.id = _countObservaciones;
                _obj.observacion = document.getElementById("ObservacionesGrles").value;
                _jsonObservaciones.push(_obj);


                $('#Obs').append("<tr>"
                    + "<td>" + document.getElementById("ObservacionesGrles").value + "</td>"
                    + "<td>" + "<button type=\"button\" id=\"btn\" name=\"btn\" class=\"btn btn-primary\" onclick=\"eliminarObservacion(" + _countObservaciones + ") \">Eliminar</button>" + "</td></tr>");

                _countObservaciones = _countObservaciones + 1;

                sum_Obs += 1;
                $('#add_Obs').val(sum_Obs);
                $('#ObservacionesGrles').val("");
                $("#ObservacionesGrles").focus();
                llenarObservacionesResumen();
            //}
        }

        function eliminarObservacion(id) {
            var item = _jsonObservaciones.find(x => x.id === id);

            let _index = _jsonObservaciones.indexOf(item);
            if (_index > -1) {
                _jsonObservaciones.splice(_index, 1);
            }

            $('#Obs').empty();
            for (var x = 0; x < _jsonObservaciones.length; x++) {

                $('#Obs').append("<tr>"
                    + "<td>" + _jsonObservaciones[x].observacion + "</td>"
                    + "<td>" + "<button type=\"button\" id=\"btn\" name=\"btn\" class=\"btn btn-primary\" onclick=\"eliminarObservacion(" + _jsonObservaciones[x].id + ") \">Eliminar</button>" + "</td></tr>");
            }
            llenarObservacionesResumen();
        }

        function seleccionarProducto() {
            $('#ddlCategorias').attr('disabled', true);
            $('#ddlMarcas').attr('disabled', true);
            $("#ddlCategorias").empty();
            $("#ddlMarcas").empty();
            $('#ddlCategorias').get(0).options[0] = new Option("--Todas las Categorias--", "0");
            $('#ddlMarcas').get(0).options[0] = new Option("--Todas las Marcas--", "0");


            $("#divTags").hide();
            $("#txtProdArt2").val("");
            $("#tblBuscador").html('');
            CargaSeleccionaProducto('');
            $("#dlgSeleccionar").modal("show");
        }

        function addProduct2() {

            $('#feedback2').append("<tr id=\"" + document.getElementById("add_product").value +"\"> <td>" + document.getElementById("add_description").value + "<br /><input type=\"text\" placeholder=\"Indicaciones y Observaciones\" class=\"form-control input-sm\"/>" + "</td>"
                + "<td>" + document.getElementById("add_price").value + "</td>"
                + "<td>" + document.getElementById("add_price_dsco").value + "</td>"
                + "<td>" + document.getElementById("Addcantidad").value + "</td>"
                + "<td>" + document.getElementById("Addcantidad").value + "</td>"
                + "<td>" + "<button type=\"button\" id=\"btn\" name=\"btn\" class=\"btn btn-primary\" onclick=\"eliminar(" + document.getElementById("add_product").value+") \">Eliminar</button>" + "</td></tr>");

            //onclick=\"eliminar(" + document.getElementById("add_product")+")

           /* $("#exampleModal").modal("hidde");*/
        }

        function eliminar(p) {
            var ba = "#" + p;

            $(ba).remove();

            //$(this).parents("tr").remove();

        }

        function BuscarCliente(param) {

            $('#divbuttonAddClient').hide();
            $('#divgridClientes').hide();
            if (param.length == 0) {
                param = $('#txtBuscarCte').val();
            }
            $("#imgSpiner").css("display", "block");
            document.getElementById("spinner").classList.add("show");

            var myTable = $('#tblBusquedaCliente').DataTable();
            //var nCant = 0;
            myTable
                .clear()
                .draw();
            $('#tblBusquedaCliente').DataTable().destroy();

            $('#tblBusquedaCliente').DataTable({

            processing: true,
            serverSide: true,
            searchable: true,
                initComplete: function (settings, json) {

                    document.getElementById("spinner").classList.remove("show");
                $("#imgSpiner").css("display", "none");

                },

            ajax: {
                url: '@Url.Action("BuscarCliente2", "CallCenter")',
                type: 'POST',
                data: {
                    Criterio: param

                },
              "datatype": "json",

                complete: function () { // Set our complete callback, adding the .hidden class and hiding the spinner.
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");

                }

            },
                columns: [
                    { data: "Nom_Cte" },
                    { data: "Id_Email" },
                    { data: "Direccion" },
                    { data: "Telefono" },
                    {
                        //adds td row for button
                        data: null,
                        render: function (data, type, row) {
                            return "<a title='Click para Seleccionar el Cliente' class='link-primary' onclick='SelCte(\""
                                //+ data.Id_Email + "\"," + data.Id_Cnsc_DirCTe+")'>Seleccionar Cliente</a>";
                                + data.Telefono + "\"," + data.Id_Cnsc_DirCTe+")'>Seleccionar Cliente</a>";


                        }
                    }

                ]
        });
            $('#divgridClientes').show();
            @*$.ajax({
                //async: false,
                type: "GET",
                url: '@Url.Action("BuscarCliente", "CallCenter")',
                data: {
                    Criterio: param

                },
                datatype: "html",
                beforeSend: function () {
                    $("#imgSpiner").css("display", "block");
                    document.getElementById("spinner").classList.add("show");
                },
                complete: function () { // Set our complete callback, adding the .hidden class and hiding the spinner.
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");

                },
                success: function (json) {

                    if (json.Success) {
                        if (json.existe) {
                            $('#divgridClientes').show();
                            $('#tblBusquedaCliente').dataTable({
                                "aaData": json.resp,
                                columns: [
                                    { data: "Nom_Cte" },
                                    { data: "Id_Email" },
                                    { data: "Direccion" },
                                    { data: "Telefono" },
                                    { data: "Telefono" },

                                ]
                            })

                            //var myTable = $('#tblBusquedaCliente').DataTable();
                            //var nCant = 0;
                            //myTable
                            //    .clear()
                            //    .draw();
                            //for (var i = 0; i < json.resp.length; i++) {


                            //    myTable.row.add([

                            //        json.resp[i].Nom_Cte + ' ' + json.resp[i].Ap_Paterno + ' ' + json.resp[i].Ap_Materno,
                            //        json.resp[i].Id_Email,
                            //        json.resp[i].Direccion,
                            //        json.resp[i].Telefono,
                            //        "<a title='Click para Seleccionar el Cliente' class='link-primary' onclick='SelCte(\""
                            //        + json.resp[i].Id_Email + "\"," + json.resp[i].Id_Cnsc_DirCTe+")'>Seleccionar Cliente</a>"
                            //    ]).draw();
                            //}
                        }
                        else {
                            $('#divbuttonAddClient').show();
                        }
                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");
                    alert(errorThrown);

                }
            });*@
        }

        function SelCte(mail,idcte) {
            $.ajax({

                type: "GET",
                url: '@Url.Action("VerificaCliente", "CallCenter")',
                data: {
                    Criterio: mail,
                    Id_Cnsc_DirCTe: idcte
                },
                datatype: "html",
                success: function (json) {

                    if (json.Success) {
                        if (json.existe) {

                                LlenaDatosCte(json.resp, json.resp.Id_Cnsc_DirCTe);
                                $('#divVerificaCliente').hide();
                                $('#divBuscaCliente').hide();
                                $('#divResultClient').show();
                                $("#dlgListClients").modal("hide");
                                $('#divgridClientes').hide();
                                $("#dlgBuscadorCliente").modal("hide");

                        }
                        else {
                            popAddClient();
                            $("#divMsjAddClient").show();
                        }
                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);

                }
            });
        }

        function VerificaCliente() {
            //$('#divVerificaCliente').hide();
            //$('#divBuscaCliente').hide();
            //$('#divResultClient').show();



            var parm = $('#txtVerificaC').val();
            if (parm.length == 0) {
                $('#txtVerificaC').focus();
                return;
            }
            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("VerificaCliente", "CallCenter")',
                data: {
                    Criterio: parm

                },
                datatype: "html",
                success: function (json) {

                    if (json.Success) {
                        if (json.existe) {
                            if (json.total == 1) {
                                LlenaDatosCte(json.resp, json.resp.Id_Cnsc_DirCTe);
                                $('#divVerificaCliente').hide();
                                $('#divBuscaCliente').hide();
                                $('#divResultClient').show();
                            } else {
                                BuscarCliente(parm);
                                popBuscarClient();
                            }

                        }
                        else {
                            popAddClient();
                           // $("#divMsjAddClient").show();
                        }
                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);

                }
            });
        }

        function NuevaBusqueda() {

            $('#txtVerificaC').val('');
            $('#divVerificaCliente').show();
            $('#divBuscaCliente').show();
            $('#divResultClient').hide();
            $('#txtVerificaC').focus();
        }

        function popAddClient() {

            $("txtCteEamil").prop('disabled', false);
            $("#txtCteNombre").val('');
            $("#txtCteApPaterno").val('');
            $("#txtCteApMaterno").val('');
            $("#txtCteCalle").val('');
            $("#txtCteNomDir").val('');
            $("#txtCteNumExt").val('');
            $("#txtCteNumInt").val('');
            $("#txtCteCiudad").val('');
            $("#txtCteCp").val('');
            $("#ddlCteColonia").val("0");
            $("#txtCteTelefono").val('');
            $("#txtCteEamil").val('');
            $("#txtCteTarjetaLealtad").val('');


            $("#hddIdCliente").val('0');
            $("#hddIdDirCteUpd").val('0');
            $("#divMsjAddClient").hide();
            $("#txtCteEamil").focus();
            $('#ddlCteEstado').val('0');
            $("#dlgAddClients").modal("show");
            $("#txtCteEamil").focus();
        }

        function popBuscador() {
            $("#dlgBuscador").modal("show");
        }

        function popBuscarClient() {
            $("#txtBuscarCte").val('');
            var myTable = $('#tblBusquedaCliente').DataTable();
            //var nCant = 0;
            myTable
                .clear()
                .draw();
            $('#tblBusquedaCliente').DataTable().destroy();

            $('#divgridClientes').show();
            $("#dlgBuscadorCliente").modal("show");
        }

        function popHistorial() {

                        var _Id_Num_Cte = $("#hddIdCliente").val();
              $.ajax({

                      complete: function () { // Set our complete callback, adding the .hidden class and hiding the spinner.
                          document.getElementById("spinner").classList.remove("show");
                          $("#imgSpiner").css("display", "none");

                      },
                      beforeSend: function () {
                          $("#imgSpiner").css("display", "block");
                          document.getElementById("spinner").classList.add("show");
                          $("#divTags").show();

                      },
                type: "GET",
                url: '@Url.Action("GetHistorial", "CallCenter")',
                data: {

                    Id_Num_Cte: _Id_Num_Cte

                },
                datatype: "html",
                success: function (json) {

                    if (json.Success) {


                        var myTable = $('#tblHistorial').DataTable();




                        myTable
                            .clear()
                            .draw();
                        for (var i = 0; i < json.resp.length; i++) {

                            myTable.row.add([

                                "<td stryle='text-align: center;'><a title='Click para Seleccionar la Orden' class='link-primary' onclick='SelOrdHist(\""
                                + json.resp[i].UeNo + "\")'>"+ json.resp[i].UeNo +"</a></td>",
                                json.resp[i].OrderDate,
                                '$' + parseFloat( json.resp[i].Imp_Pago).toFixed(2),
                                "0"
                            ]).draw();
                        }


                        $('#divHistorialDetalle').hide();
                        $('#divHistorialOrd').show();
                        $("#dlgHistorial").modal("show");
                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                   alert(errorThrown);

                }
            });
        }

        function regresarHist(){
            $('#divHistorialDetalle').hide();
            $('#divHistorialOrd').show();
        }

        function SelOrdHist(UeNo) {
                          $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("HistorialDetalle", "CallCenter")',
                data: {

                    UeNo: UeNo

                },
                datatype: "html",
                              success: function (data) {
                            $('#divHistorialOrd').hide();
                            $("#divHistorialDetalle").html(data);
                            $("#divHistorialDetalle").show();

                }
                , error: function (jqXHR, textStatus, errorThrown) {
                   alert(errorThrown);

                }
            });
        }

        function AddClient() {
            //alert("addclient");
            var Nom_Cte = $("#txtCteNombre").val();
            var Ap_Paterno = $("#txtCteApPaterno").val();
            var Ap_Materno = $("#txtCteApMaterno").val();
            var Calle = $("#txtCteCalle").val();
            var Nom_DirCTe = $("#txtCteNomDir").val();
            var Num_Ext = $("#txtCteNumExt").val();
            var Num_Int = $("#txtCteNumInt").val();
            var Ciudad = $("#txtCteCiudad").val();
            var Cod_Postal = $("#txtCteCp").val();
            var Colonia = $("#ddlCteColonia").val();
            var Telefono = $("#txtCteTelefono").val();
            var Id_Email = $("#txtCteEamil").val();
            var TarjetaLealtad = $("#txtCteTarjetaLealtad").val();
            var Ids_Num_Edo = $("#ddlCteEstado").val();

            var Id_Cnsc_DirCTe = $("#hddIdDirCteUpd").val();
            var Id_Num_Cte = $("#hddIdCliente").val();




            //if (Id_Email.length == 0) {
            //    $("#txtCteEamil").focus();
            //    return;
            //}
            if (($("#txtCteEamil").val().indexOf('@@', 0) == -1 || $("#txtCteEamil").val().indexOf('.', 0) == -1) && Id_Email.length > 0) {
                    $("#txtCteEamil").focus();
                    alert('El correo electrónico introducido no es correcto.');
                    return false;
                }


            if (Nom_Cte.length == 0) {
                $("#txtCteNombre").focus();
                return;
            }
            if (Ap_Paterno.length == 0) {
                $("#Ap_Paterno").focus();
                return;
            }
            if (Ap_Materno.length == 0) {
                $("#txtCteApMaterno").focus();
                return;
            }
            if (Calle.length == 0) {
                $("#txtCteCalle").focus();
                return;
            }
            if (Nom_DirCTe.length == 0) {
                $("#txtCteNomDir").focus();
                return;
            }
            if (Num_Ext.length == 0) {
                $("#txtCteNumExt").focus();
                return;
            }
            if (Ciudad.length == 0) {
                $("#txtCteCiudad").focus();
                return;
            }
            if (Cod_Postal.length == 0) {
                $("#txtCteCp").focus();
                return;
            }
            if (Colonia == 0) {
                $("#ddlCteColonia").focus();
                return;
            }
            if (Telefono.length == 0) {
                $("#txtCteTelefono").focus();
                return;
            }

            if (Ids_Num_Edo == "0") {
                $("#ddlCteEstado").focus();
                return;
            }

            //alert("va a guardar");
              $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("AddClient", "CallCenter")',
                data: {
                    Nom_Cte: Nom_Cte,
                    Ap_Materno: Ap_Materno,
                    Ap_Paterno: Ap_Paterno,
                    Calle: Calle,
                    Nom_DirCTe: Nom_DirCTe,
                    Num_Ext: Num_Ext,
                    Num_Int: Num_Int,
                    Ciudad: Ciudad,
                    Cod_Postal: Cod_Postal,
                    Colonia: Colonia,
                    Telefono: Telefono,
                    Id_Email: Id_Email,
                    TarjetaLealtad: TarjetaLealtad,
                    Ids_Num_Edo: Ids_Num_Edo,
                    Id_Cnsc_DirCTe: Id_Cnsc_DirCTe,
                    Id_Num_Cte: Id_Num_Cte


                },
                datatype: "html",
                success: function (json) {

                    if (json.Success) {
                        LlenaDatosCte(json.resp, json.resp.Id_Cnsc_DirCTe);
                        $('#divVerificaCliente').hide();
                        $('#divBuscaCliente').hide();
                        $('#divResultClient').show();

                        $("#dlgAddClients").modal('hide');
                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);

                }
            });
        }

        function LlenaDatosCte(resp,idDirCte) {


            $("#hddIdCliente").val(resp.Id_Num_Cte);
            $("#hddIdDirCteUpd").val(idDirCte);
            $('#lblNombreCte').text(resp.Nom_Cte + ' ' + resp.Ap_Paterno + ' ' + resp.Ap_Materno);
            $('#lblFolioCte').text(resp.Id_Num_Cte);
            $('#lblClaveCte').text(resp.Id_Email);
            $('#lblTarjetaLealtad').text(resp.TarjetaLealtad);
            if (resp.Num_Int == null) {
                $('#lblCalleCte').text(resp.Calle + ' ' + resp.Num_Ext);
            } else {
                $('#lblCalleCte').text(resp.Calle + ' ' + resp.Num_Ext + ',No. Int. ' + resp.Num_Int);
            }

            $('#lblColoniaCte').text(resp.Colonia);
            $('#lblEdoCte').text(resp.Ciudad + ', ' + resp.Nom_Edo);
            $('#lblCpCte').text('C.P. '+ resp.Cod_Postal);
            $('#lblTelefonoCte').text(resp.Telefono);


        }

        function onchangeDias() {

            var _fechaOriginal = Date.now();
            var _fecha = $("#ddlDias").val(); //$("[id='ddlDias'] option:selected").text();
            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetHorasEntrega", "CallCenter")',
                data: {
                    fechaSelec:_fecha
                },
                datatype: "html",
                success: function (json) {

                    if (json.Success)
                    {
                        var sel = $("#ddlHoras");
                        sel.empty();

                        for (var i = 0; i < json.json.length; i++) {
                            sel.append('<option value="' + json.json[i].fecha + '">' + json.json[i].NombeDia + '</option>');
                        }
                }
            }
            , error: function (jqXHR, textStatus, errorThrown) {
            bootbox.alert(errorThrown);

            }
            });
        }

        function GetDirCteIdNumCte() {

              var _Id_Num_Cte = $("#hddIdCliente").val();
            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetDirCteIdNumCte", "CallCenter")',
                data: {
                    Id_Num_Cte: _Id_Num_Cte

                },
                datatype: "html",
                success: function (json) {

                    if (json.Success) {
                        $('#tblDirecciones tbody').empty();
                        //var tr;

                        //Append each row to html table

                        for (var i = 0; i < json.resp.length; i++) {
                            tr = $('<tr/>');


                            tr.append("<td>  <b> " + json.resp[i].Nom_DirCTe + "</b > <br>" + json.resp[i].Direccion + "</td>");
                            //<button type="button" class="btn btn-default btn btn-xs" onclick="GetTdasTrasp()">
                            tr.append("<td><button onclick='SelDirCte(" + json.resp[i].Id_Cnsc_DirCTe + ")' type = 'button' class= 'btn btn-default btn btn-xs'>Utilizar esta direcci&oacute;n</button></td >");
                            if (json.total > 1) {
                                tr.append("<td><button onclick='DelDirCte(" + json.resp[i].Id_Cnsc_DirCTe + ")' type = 'button' class= 'btn btn-default btn btn-xs'>Eliminar esta direcci&oacute;n</button></td >");
                            } else {
                                tr.append("<td></td>");
                            }
                                $('#tblDirecciones').append(tr);
                        }

                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                   alert(errorThrown);

                }
            });
        }

        function SelDirCte(id) {
            var _Id_Num_Cte = $("#hddIdCliente").val();
              $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GetDirDirCteIdDirCTe", "CallCenter")',
                data: {
                    Id_Cnsc_DirCTe: id,
                    Id_Num_Cte: _Id_Num_Cte

                },
                datatype: "html",
                success: function (json) {

                    if (json.Success) {

                        $("#hddIdDir").val(json.resp.Id_Cnsc_DirCTe);
                        $("#rec_tel").val(json.resp.Telefono);
                        $("#rec_name").val(json.resp.Nom_DirCTe);
                        $("#rec_ciudad").val(json.resp.Ciudad);
                        $("#ddlRec_Estado").val(json.resp.Ids_Num_Edo);
                        $("#rec_calle").val(json.resp.Calle);
                        $("#rec_num").val(json.resp.Num_Ext);
                        $("#rec_nunInt").val(json.resp.Num_Int);
                        $("#rec_col").val(json.resp.Colonia);
                        $("#rec_CP").val(json.resp.Cod_Postal);


                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                   alert(errorThrown);

                }
            });
        }

        function GetCp(_postalCode) {
            //alert($("#txtCodPos").val());
            //var _postalCode = $("#txtCodPos").val();

            if (_postalCode.length == 5) {
                $.ajax({
                    async: false,
                    type: "GET",
                    url: '@Url.Action("GetInfoByCP", "AltaProveedor")',
                    data: {
                        postalCode: _postalCode
                    },
                    datatype: "html",
                    success: function (json) {
                        //
                        if (json.Success) {

                            GetEstados();
                            var sel = $("#ddlCteColonia");
                            sel.empty();



                            $('#ddlCteColonia').get(0).options[0] = new Option("--SELECCIONE--", "0");
                            for (var i = 0; i < json.resp.length; i++) {
                                sel.append('<option value="' + json.resp[i].SubLocality + '">' + json.resp[i].SubLocality + '</option>');
                            }

                            if (json.resp.length > 0) {
                                $("#txtCteCiudad").val(json.resp[0].Locality);

                                //$("#ddlCteEstado").find("option[text=" + json.resp[0].Region1Name + "]").attr("selected", true);
                                /// alert(json.resp[0].Region1Name);
                                $('#ddlCteEstado option:contains(' + json.resp[0].Region1Name + ')').attr('selected', 'selected');
                            }
                            else {
                                $("#txtCteCiudad").val('');
                                alert("No hay resultados para el Código Postal Ingresado.")
                            }
                        }
                        else {
                            alert(json.Message);
                        }
                    }
                    , error: function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown);

                    }

                });
            }

        }


        function GetCpDirEnt(_postalCode) {
            //alert($("#txtCodPos").val());
            //var _postalCode = $("#txtCodPos").val();

            if (_postalCode.length == 5) {
                $.ajax({
                    async: false,
                    type: "GET",
                    url: '@Url.Action("GetInfoByCP", "AltaProveedor")',
                    data: {
                        postalCode: _postalCode
                    },
                    datatype: "html",
                    success: function (json) {
                        //
                        if (json.Success) {

                            //
                            //var sel = $("#ddlCteColonia");
                            //sel.empty();

                            //$('#ddlCteColonia').get(0).options[0] = new Option("--SELECCIONE--", "0");
                            //for (var i = 0; i < json.resp.length; i++) {
                            //    sel.append('<option value="' + json.resp[i].SubLocality + '">' + json.resp[i].SubLocality + '</option>');
                            //}

                            if (json.resp.length > 0) {
                                $("#rec_ciudad").val(json.resp[0].Locality);

                                //$("#ddlCteEstado").find("option[text=" + json.resp[0].Region1Name + "]").attr("selected", true);

                                $('#ddlRec_Estado option:contains(' + json.resp[0].Region1Name + ')').attr('selected', 'selected');
                            }

                        }
                        else {
                            alert(json.Message);
                        }
                    }
                    , error: function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown);

                    }

                });
            }

        }

        function GetEstados() {


                $.ajax({
                    async: false,
                    type: "GET",
                    url: '@Url.Action("GetEstados", "CallCenter")',
                    data: {

                    },
                    datatype: "html",
                    success: function (json) {
                        //
                        if (json.Success) {


                            var sel = $("#ddlCteEstado");
                            sel.empty();

                            $('#ddlCteEstado').get(0).options[0] = new Option("--SELECCIONE--", "0");
                            for (var i = 0; i < json.resp.length; i++) {
                                sel.append('<option value="' + json.resp[i].Id_Num_Estado + '">' + json.resp[i].Nom_Estado + '</option>');
                            }


                            var sel2 = $("#ddlRec_Estado");
                            sel2.empty();

                            $('#ddlRec_Estado').get(0).options[0] = new Option("--SELECCIONE--", "0");
                            for (var i = 0; i < json.resp.length; i++) {
                                sel2.append('<option value="' + json.resp[i].Id_Num_Estado + '">' + json.resp[i].Nom_Estado + '</option>');
                            }
                        }
                        else {
                            alert(json.Message);
                        }
                    }
                    , error: function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown);

                    }

                });


        }

        function popEditarCte() {

            $("txtCteEamil").prop('disabled', true);
            var idDirCte = $("#hddIdDirCteUpd").val();
            var email = $('#lblTelefonoCte').text();
                    $.ajax({
                complete: function () { // Set our complete callback, adding the .hidden class and hiding the spinner.
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");

                },
                beforeSend: function () {
                    $("#imgSpiner").css("display", "block");
                    document.getElementById("spinner").classList.add("show");
                    $("#divTags").show();

                },
                type: "GET",
                url: '@Url.Action("VerificaCliente", "CallCenter")',
                data: {
                    Criterio: email,
                    Id_Cnsc_DirCTe: idDirCte
                },
                datatype: "html",
                success: function (json) {

                    if (json.Success) {



                        $("#hddIdDirCteUpd").val(json.resp.Id_Cnsc_DirCTe);
                        $("#txtCteNombre").val(json.resp.Nom_Cte);
                        $("#txtCteApPaterno").val(json.resp.Ap_Paterno);
                        $("#txtCteApMaterno").val(json.resp.Ap_Materno);
                        $("#txtCteCalle").val(json.resp.Calle);
                        $("#txtCteNomDir").val(json.resp.Nom_DirCTe);
                        $("#txtCteNumExt").val(json.resp.Num_Ext);
                        $("#txtCteNumInt").val(json.resp.Num_Int);
                        $("#txtCteCiudad").val(json.resp.Ciudad);
                        $("#txtCteCp").val(json.resp.Cod_Postal);
                        //$("#ddlCteColonia").val("0");
                        $("#txtCteTelefono").val(json.resp.Telefono);
                        $("#txtCteEamil").val(json.resp.Id_Email);
                        $("#txtCteTarjetaLealtad").val(json.resp.TarjetaLealtad);
                        $("#ddlCteEstado").val(json.resp.Ids_Num_Edo);
                        GetCp(json.resp.Cod_Postal);
                        $('#ddlCteColonia option:contains(' + json.resp.Colonia + ')').attr('selected', 'selected');
                        $("#divMsjAddClient").hide();
                        $("#txtCteEamil").focus();

                        $("#dlgAddClients").modal("show");
                        $("#txtCteEamil").focus();
                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);

                }
            });


        }

        function GetCategorias() {
                    $.ajax({
                    async: false,
                    type: "GET",
                    url: '@Url.Action("GetCategorias", "CallCenter")',
                    data: {

                    },
                    datatype: "html",
                    success: function (json) {
                        //
                        if (json.Success) {

                            //var availableTags = [];
                            //for (var i = 0; i < json.resp.length; i++) {

                            //    availableTags.push(json.resp[i].NombreCategoria );
                            //}


                            //$("#tags").autocomplete({
                            //    source: availableTags
                            //});



                            var sel = $("#ddlCategorias");
                            sel.empty();

                            $('#ddlCategorias').get(0).options[0] = new Option("--Todas las Categorias--", "0");
                            for (var i = 0; i < json.resp.length; i++) {
                                sel.append('<option value="' + json.resp[i].NombreCategoria + '">' + json.resp[i].NombreCategoria  + '</option>');
                            }

                        }
                        else {
                            alert(json.Message);
                        }
                    }
                    , error: function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown);

                    }

                });
        }

        function EcharCarrito(UeNo) {
            var _tda = $("#ddlTdas").val();


            try {
                 $.ajax({
                "url": "@Url.Action("EcharCarrito", "CallCenter")",

                "type": "get",
                "data": {
                 UeNo: UeNo,
                 tienda: _tda
             },
                "dataType": "json",
                complete: function () { // Set our complete callback, adding the .hidden class and hiding the spinner.
                    document.getElementById("spinner").classList.remove("show");
                    $("#imgSpiner").css("display", "none");

                },
                beforeSend: function () {
                    $("#imgSpiner").css("display", "block");
                    document.getElementById("spinner").classList.add("show");
                    $("#divTags").show();

                },
                "success": function (data)
                {
                    if (data.resp != null) {
                        for (var i = 0; i < data.resp.length; i++) {
                            var precio = parseFloat(data.resp[i].Price).toFixed(2);
                            var precioO = parseFloat(data.resp[i].PromotionalPrice).toFixed(2);
                            if (precioO == 0) {
                                precioO = precio;
                            }

                            var baseUnit = "", equivalentUnit = "", factorConversion = 0;

                            if (data.resp[i].ConversionRule != null) {
                                baseUnit = data.resp[i].ConversionRule.baseUnit;
                                equivalentUnit = data.resp[i].ConversionRule.equivalentUnit;
                                factorConversion = data.resp[i].ConversionRule.factorConversion;

                                if (baseUnit.toLowerCase() == "piezas") { baseUnit = 'pza'; }
                                if (equivalentUnit.toLowerCase() == "piezas") { equivalentUnit = 'pza'; }
                            }
                            debugger;

                            AddFlete(data.resp[i].Description, data.resp[i].Barcode, precio, data.resp[i].Sku, data.resp[i].SalesUnit, precioO, 1, baseUnit, equivalentUnit, factorConversion)

                        }
                        $("#dlgHistorial").modal("hide");
                        $("#divOkArtHistorial").show();
                        setTimeout(function () {
                            $("#divOkArtHistorial").fadeOut(1000);
                        }, 1000);
                    } else {
                        alert("No se encontraron productos para la tienda seleccionada.");
                    }
                }
            });
            } catch (error) {
                document.getElementById("spinner").classList.remove("show");
                $("#imgSpiner").css("display", "none");
                alert(error);
                // expected output: ReferenceError: nonExistentFunction is not defined
                // Note - error messages will vary depending on browser
            }



        }

        function conversionRule(BarCode,op) {
            //op 1 === TABLA BUSCADOR
            //OP 2 === TABLA CARRITO
            var cant = 0;
            var nCantidad = 0;
            var unitSale = ""
            var _html = "";
            if (op == 1) {
                cant = $("#nCant-" + BarCode).val();
                $("#divUS-" + BarCode).html("");
                unitSale = $("#um-" + BarCode).val();
                nCantidad = nuevaCantidadCR(unitSale, BarCode, 'facConvB', cant)
                if (unitSale == "pza") {
                    _html = "<input oninput='javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);' maxlength='5' onkeypress='return event.charCode >= 48' min='1' step='1' type='number' id='nCant-" + BarCode + "' value='" + nCantidad + "' class='form-control input-sm pull-right' />";
                }
                else {
                    _html = " <input oninput='inputCar(this)' min='1' step='1' type='number' id='nCant-" + BarCode + "' value='" + nCantidad + "' class='form-control input-sm pull-right' />"
                }
            }
            else {
                cant = $("#productCant-" + BarCode).val();
                $("#divUSC-" + BarCode).html("");
                unitSale = $("#umc-" + BarCode).val();
                nCantidad = nuevaCantidadCR(unitSale, BarCode, 'facConvC', cant)
                if (unitSale == "pza") {
                    _html = "<input onfocusout='Change(\"" + BarCode + "\")'  onchange='Change(\"" + BarCode + "\")' oninput='javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);' maxlength='5' onkeypress='return event.charCode >= 48' min='1' step='1' type='number' id='productCant-" + BarCode + "' value='" + nCantidad + "' class='form-control input-sm pull-right' />";
                }
                else {
                    _html = " <input onfocusout='Change(\"" + BarCode + "\")'  onchange='Change(\"" + BarCode + "\")' onkeypress='return isNumberKey(event,this,4,9)' min='1' step='1' type='number' id='productCant-" + BarCode + "' value='" + nCantidad + "' class='form-control input-sm pull-right' />"
                }

            }

            if (op == 1) {
                $("#divUS-" + BarCode).html(_html);
            } else {
                $("#divUSC-" + BarCode).html(_html);
                $("#productCant-" + BarCode).focus();
            }
        }

        function nuevaCantidadCR(nUnidadMedidad, BarCode,nCtrl,cantidad) {
            var factorConversion =parseFloat( $("#" + nCtrl + "-" + BarCode).val()).toFixed(2);
            var nCantidad = 0;
            if (nUnidadMedidad == 'pza') {
                nCantidad = parseFloat((cantidad * factorConversion) / 1).toFixed(0);
            }
            else {
                nCantidad = parseFloat((cantidad / factorConversion)).toFixed(3);
            }

            return nCantidad;
        }

        function isNumberKey(evt, element,decimals,size) {
            var charCode = (evt.which) ? evt.which : event.keyCode
            if (charCode > 31 && (charCode < 48 || charCode > 57) && !(charCode == 46 || charCode == 8))
                return false;
            else {
                var len = $(element).val().length;
                var index = $(element).val().indexOf('.');
                if (index > 0 && charCode == 46) {
                    return false;
                }
                if (index > 0) {
                    var CharAfterdot = (len + 1) - index;
                    if (CharAfterdot > decimals) {
                        return false;
                    }
                }
                if (size > 0) {
                    if (len > size) { return false; }
                }

            }
            return true;
        }
        function blurDecimal(obj) {
            if (obj.value == "") {
                obj.value = "0.00";
            } else {
                var val = parseFloat(obj.value).toFixed(2);
                if (val.includes("e+")) { obj.value = "0.00"; }
                else {

                    if (val > 99999) {
                        alert("El monto máximo de $99,999.00")
                        obj.value = "0.00";
                    } else {
                        obj.value = parseFloat(obj.value).toFixed(2);
                    }
                }
            }
        }


        function notC (n) {
            var str = parseFloat(n).toFixed();
            if (str.indexOf('e+') === -1)
                return str;

            // if number is in scientific notation, pick (b)ase and (p)ower
            str = str.replace('.', '').split('e+').reduce(function (b, p) {
                return b + Array(p - b.length + 2).join(0);
            });

            if (n > 0)
                str += '.' + Array(n + 1).join(0);

            return str;
        };

        function DelDirCte(id) {

            if (!confirm("¿Desea elimnar esta dirección?")) {
                return false;
            }
            var _Id_Num_Cte = $("#hddIdCliente").val();
              $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("DelDirCte", "CallCenter")',
                data: {
                    Id_Cnsc_DirCTe: id,
                    Id_Num_Cte: _Id_Num_Cte

                },
                datatype: "html",
                success: function (json) {

                    if (json.Success) {

                        GetDirCteIdNumCte();


                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                   alert(errorThrown);

                }
            });
        }
    </script>

}
