@{ ViewBag.Title = "Alta de Almacenes";
    Layout = "~/Views/Shared/_Layout.cshtml"; }


<div class="wrapper wrapper-content animated fadeInRight" style="padding-top: 0px;">
    <div class="row">
        <div class="col-xs-12 col-md-12 col-lg-12">
            <div class="ibox-content p-xl" style="padding-top: 0px;padding-bottom: 0px;">
                <div class="row">
                    <div class="col-xs-12 col-md-12 col-lg-12 text-center">
                        <h2> Alta de Almacenes</h2>
                    </div>
                </div>
                <div class="row">
                    <table style="width:100%;">
                        <tr>
                            <td style="width:15%;text-align:center;">
                                Número de Proveedor
                            </td>
                            <td>
                                @Html.TextBox("txtNumPro", null, new
                                    {
                                    @class = "form-control ;",
                                    @onkeydown = "javascript:onkeydown_busqueda(event)"
                                    })
                            </td>
                            <td style="width:15%;text-align:center;">
                                Nombre de Proveedor
                            </td>
                            <td>
                                <input type="text" class="form-control" id="txtNomPro" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="6"><hr /></td>
                        </tr>
                    </table>
                    <table style="width:100%;">
                        <tr>
                            <td style="width:15%;text-align:center;">
                                Tipo Almacén
                            </td>
                            <td>
                                <select class="form-control m-b" id="lstIdAlmacen"></select>
                            </td>
                            <td style="width:15%;text-align:center;">
                                Número Almacén
                            </td>
                            <td>
                                <input type="text" class="form-control" id="txtNumAlmacen" />
                            </td>
                            <td style="width:15%;text-align:center;">
                                Nombre Almacén
                            </td>
                            <td>
                                <input type="text" class="form-control" id="txtNomAlmacen" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="6"><hr /></td>
                        </tr>
                    </table>
                    <table style="width:100%;">
                        <tr>
                            <td colspan="6">
                                <b> Direccion del Almacén </b>
                            </td>
                        </tr>

                        <tr>
                            <td style="width:15%;text-align:center;">
                                Calle
                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtCalle" />
                            </td>
                            <td style="width:15%;text-align:center;">
                                Número Exterior

                            </td>
                            <td>
                                <input type="text" class="form-control" id="txtNumExt" />
                            </td>
                            <td style="width:15%;text-align:center;">
                                Número Interior

                            </td>
                            <td>
                                <input type="text" class="form-control" id="txtNumInt" />
                            </td>

                        </tr>
                        <tr>
                            <td style="width:15%;text-align:center;">
                                Cuidad/Delegación/Municipio

                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtCiudad" />
                            </td>
                            <td style="width:15%;text-align:center;">
                                CP.

                            </td>
                            @*<td style="text-align:left;">
                                <input type="number" min="1" max="99999" class="form-control" id="txtCodPos" />
                            </td>*@
                            <td>
                                @Html.TextBox("txtCodPos", null, new
                                    {
                                    @class = "form-control ;",
                                    @onkeydown = "javascript:onkeydown_cp(event)"
                                    })
                            </td>
                            <td style="width:15%;text-align:center;">
                                Estado
                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtEdo" />
                            </td>
                        </tr>
                        <tr>
                            <td style="width:15%;text-align:center;">
                                Entre calle 1

                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtEntCal1" />
                            </td>
                            <td style="width:15%;text-align:center;">
                                Entre calle 2

                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtEntCal2" />
                            </td>
                            <td style="width:15%;text-align:center;">
                            </td>
                            <td style="text-align:left;">
                            </td>
                        </tr>
                        <tr>
                            <td colspan="6"><hr /></td>
                        </tr>
                    </table>
                    <table style="width:100%;">
                        <tr>
                            <td colspan="3">
                                <b>
                                    Infomación de contacto operativo
                                </b>
                            </td>
                            <td colspan="3">
                                <b>
                                    Infomación de contacto comercial
                                </b>
                            </td>

                        </tr>
                        <tr>
                            <td style="width:15%;text-align:center;">
                                Nombre de contacto Operativo

                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtNomContOper" />
                            </td>
                            <td style="width: 10%;">
                            </td>


                            <td style="width:15%;text-align:center;">
                                Nombre de contacto Comercial

                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtNomContCom" />
                            </td>
                            <td style="width: 10%;">
                            </td>

                        </tr>
                        <tr>
                            <td style="width:15%;text-align:center;">
                                Teléfono del contacto Operativo

                            </td>

                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtTelContOper" />

                            </td>
                            <td style="width: 10%;">
                            </td>
                            <td style="width:15%;text-align:center;">
                                Teléfono del contacto Comercial

                            </td>


                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtTelContCom" />
                            </td>
                            <td style="width: 10%;">
                            </td>


                        </tr>
                        <tr>
                            <td style="width:15%;text-align:center;">
                                Correo electrónico

                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtEmailO" />
                            </td>
                            <td style="width: 10%;">
                            </td>

                            <td style="width:15%;text-align:center;">
                                Correo electrónico

                            </td>
                            <td style="text-align:left;">
                                <input type="text" class="form-control" id="txtEmailC" />
                            </td>
                            <td style="width: 10%;">
                            </td>
                        </tr>
                        <tr>
                            <td colspan="6"><br /></td>
                        </tr>
                        <tr>
                            <td colspan="4">
                            </td>
                            <td>
                                <button type="button" class="btn btn-white" onclick="Save()">GUARDAR</button>
                            </td>
                            @*<td>
                                <button type="button" class="btn btn-primary" onclick="TraspasaOrden()">EDITAR</button>
                            </td>*@
                        </tr>
                        <tr>
                            <td colspan="6"><br /><br /><br /></td>
                        </tr>

                    </table>

                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            IniciarCombo()
        });

        function onkeydown_cp(e) {

            switch (e.which) {
                case 9:
                case 13:
                case 19:
                    RellenarCP();
                    break;
            }
        }

        function onkeydown_busqueda(e) {

            switch (e.which) {
                case 9:
                case 13:
                case 19:
                    ObtenerDatos();
                    break;
            }
        }

        function RellenarCP() {
            var _txtCodPos = ("00000" + $("#txtCodPos").val()).substr(-5, 5);
            $("#txtCodPos").val(_txtCodPos);
        }

        function ObtenerDatos() {
            var _txtNumPro = $("#txtNumPro").val();
            if (_txtNumPro.length != 0) {
                $.ajax({
                    async: false,
                    type: "GET",
                    url: '@Url.Action("ConsecutivoAlmacen", "AltaProveedor")',
                    data: {
                        idSupplierWH: _txtNumPro
                    },
                    datatype: "html",
                    success: function (json) {
                        debugger;
                        if (json.Success) {
                            $("#txtNumAlmacen").val(json.resp[0].idSupplierWHCode);
                            $("#txtNomPro").val(json.resp[0].supplierName);
                        }
                        else {
                            alert(json.Message);
                        }
                    }
                    , error: function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown);

                    }

                });
            }
        }

        function IniciarCombo() {
            $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("IniciarComboTipoAlmacen", "AltaProveedor")',
                data: {

                },
                datatype: "html",
                success: function (json) {
                    debugger;
                    if (json.Success) {
                        var sel = $("#lstIdAlmacen");
                        sel.empty();

                        $('#lstIdAlmacen').get(0).options[0] = new Option("--SELECCIONE--", "0");
                        for (var i = 0; i < json.resp.length; i++) {
                            sel.append('<option value="' + json.resp[i].idOwner + '">' + json.resp[i].ownerName +  '</option>');
                        }
                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);

                }
            });
        }

        function Save() {
            var _txtNumPro = $("#txtNumPro").val();
            var _txtNomPro = $("#txtNomPro").val();
            var _txtIdAlmacen = $("#lstIdAlmacen").val();
            var _txtNumAlmacen = $("#txtNumAlmacen").val();
            var _txtNomAlmacen = $("#txtNomAlmacen").val();
            var _txtCalle = $("#txtCalle").val();
            var _txtNumExt = $("#txtNumExt").val();
            var _txtNumInt = $("#txtNumInt").val();
            var _txtCiudad = $("#txtCiudad").val();
            var _txtCodPos = $("#txtCodPos").val();
            var _txtEdo = $("#txtEdo").val();
            var _txtEntCal1 = $("#txtEntCal1").val();
            var _txtEntCal2 = $("#txtEntCal2").val();
            var _txtNomContOper = $("#txtNomContOper").val();
            var _txtNomContCom = $("#txtNomContCom").val();
            var _txtTelContOper = $("#txtTelContOper").val();
            var _txtTelContCom = $("#txtTelContCom").val();
            var _txtEmailO = $("#txtEmailO").val();
            var _txtEmailC = $("#txtEmailC").val();
            var _creationId = 't_joserp';

            if (_txtNumPro.length == 0) {
                $("#txtNumPro").focus();
                return;
            }
            if (_txtNomPro.length == 0) {
                $("#txtNomPro").focus();
                return;
            }
            if (_txtIdAlmacen.length == 0) {
                $("#txtIdAlmacen").focus();
                return;
            }
            if (_txtNumAlmacen.length == 0) {
                $("#txtNumAlmacen").focus();
                return;
            }
            if (_txtNomAlmacen.length == 0) {
                $("#txtNomAlmacen").focus();
                return;
            }
            if (_txtCalle.length == 0) {
                $("#txtCalle").focus();
                return;
            }
            if (_txtNumExt.length == 0) {
                $("#txtNumExt").focus();
                return;
            }
            //if (_txtNumInt.length == 0) {
            //    $("#txtNumInt").focus();
            //    return;
            //}
            if (_txtCiudad.length == 0) {
                $("#txtCiudad").focus();
                return;
            }
            if (_txtCodPos.length == 0) {
                $("#txtCodPos").focus();
                return;
            }
            if (_txtEdo.length == 0) {
                $("#txtEdo").focus();
                return;
            }
            if (_txtEntCal1.length == 0) {
                $("#txtEntCal1").focus();
                return;
            }
            if (_txtEntCal2.length == 0) {
                $("#txtEntCal2").focus();
                return;
            }
            if (_txtNomContOper.length == 0) {
                $("#txtNomContOper").focus();
                return;
            }
            if (_txtNomContCom.length == 0) {
                $("#txtNomContCom").focus();
                return;
            }
            if (_txtTelContOper.length == 0) {
                $("#txtTelContOper").focus();
                return;
            }
            if (_txtTelContCom.length == 0) {
                $("#txtTelContCom").focus();
                return;
            }
            if (_txtEmailO.length == 0) {
                $("#txtEmailO").focus();
                return;
            }
            if (_txtEmailC.length == 0) {
                $("#txtEmailC").focus();
                return;
            }


             $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("GrabarProveedor", "AltaProveedor")',
                data: {
                    idSupplierWH: _txtNumPro
                    , supplierName: _txtNomPro
                    , idOwner: _txtIdAlmacen //2 SP
                    , idSupplierWHCode: _txtNumAlmacen //combo Tipo
                    , SupplierWHName: _txtNomAlmacen
                    , addressStreet: _txtCalle
                    , addressNumberExt: _txtNumExt
                    , addressNumberInt: _txtNumInt
                    , addressCity: _txtCiudad
                    , addressPostalCode: _txtCodPos
                    , addressState: _txtEdo
                    , addressReference1: _txtEntCal1
                    , addressReference2: _txtEntCal2
                    , commInfoName: _txtNomContOper
                    , operInfoName: _txtNomContCom
                    , operInfoPhone: _txtTelContOper
                    , operInfoEmail: _txtTelContCom
                    , commInfoPhone: _txtEmailO
                    , commInfoEmail: _txtEmailC
                    , creationId: _creationId
                },
                datatype: "html",
                success: function (json) {
                    debugger;
                    if (json.Success) {
                        alert("Inserción exitosa");
                        location.reload();
                    }
                    else {
                        alert(json.Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);

                }
            });
        }
    </script>
}