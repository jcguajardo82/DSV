@using ServicesManagement.Web.Models.ProcesoSurtido;
@{
    ViewBag.Title = "Proceso Surtido";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@*<style id="compiled-css" type="text/css">
        /* Fix table head */
        .tableFixHead {
            overflow-y: auto;
            height: 300px;
        }

            .tableFixHead th {
                position: sticky;
                top: 0;
            }

        /* Just common table stuff. */
        table {
            border-collapse: collapse;
            width: 100%;
            table-layout: fixed;
            word-wrap: break-word;
        }

        th, td {
            padding: 8px 16px;
        }


        th {
            /*background: #1AB394;*/
            background: #D52B1E;
            color: #ffffff;
            font-weight: bold;
            text-align: center;
        }

        function seleccionar_todo() {
            for (i=0;i<document.f1.elements.length;i++) if(document.f1.elements[i].type == "checkbox") document.f1.elements[i].checked=1
        }
    </style>*@
<div class="row wrapper border-bottom white-bg page-heading" style="padding-top:5px;padding-bottom:10px;">
    <div class="dataTables_wrapper dt-bootstrap4 no-footer">
        <div class="fixed_header dataTables_wrapper dt-bootstrap4 no-footer">
            <div class="row">
                <div class="col col-xs-12 col col-md-12 col col-lg-12 text-center" ">
                    <h2>Proceso de Surtido</h2>
                </div>
            </div>
            <div class="row">
                <div class="col col-xs-12 col col-md-12 col col-lg-12 text-center">
                    <div class="alert alert-info">
                        097865387 - Nao Reyes Ro [exo.asb@gmail.com] - 10-mar-2021 23:32:00 -  $87.00 - Pago Autorizado
                        @*<input id="hddUeNo" type="hidden" value="@ViewBag.UeNo" />
                            <input id="hddOrderNo" type="hidden" value="@ViewBag.OrderNo" />*@
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col col-xs-12 col col-md-12 col col-lg-12">
                    @if (ViewBag.Mensaje == null)
                    {
                        <div class="tabs-container">
                            <ul class="nav nav-tabs" role="tablist">
                                <li><a class="nav-link active" data-toggle="tab" href="#tab-1">Aceptar Consignación</a></li>
                                <li><a class="nav-link" data-toggle="tab" href="#tab-2">Solicitud de Guía</a></li>
                                <li><a class="nav-link" data-toggle="tab" href="#tab-3">Descarga de Guías</a></li>
                            </ul>
                            <div class="tab-content">
                                <div role="tabpanel" id="tab-1" class="tab-pane active">
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-sm-12 col-md-12 col-lg-12">
                                                <table id="tblAcepConsig" class="table table-striped table-bordered table-hover table-responsive-md expand dataTable no-footer">
                                                    <thead class="bg-danger-sor">
                                                        <tr>
                                                            <th style="text-align:center;">EAN/Código Barras</th>
                                                            <th style="text-align:center;">Descripción</th>
                                                            <th style="text-align:center;">Pzas Solicitadas para Envío</th>
                                                            <th style="text-align:center;">Tipo de Envio</th>
                                                            <th style="text-align:center;" name="accion">Art. a Surtir</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @*<div class="seleccionartodo">
                                                                <a href="javascript:seleccionar_todo()">Marcar todos</a>
                                                                <input type="checkbox" class="cbx" id="flexCheckDefault">
                                                            </div>*@
                                                        @{

                                                            IEnumerable<upCorpOms_Cns_UeNoSupplyProcess> list = ViewBag.UeNoSupplyProcess as IEnumerable<upCorpOms_Cns_UeNoSupplyProcess>;

                                                        }
                                                        @foreach (upCorpOms_Cns_UeNoSupplyProcess item in list)
                                                        {
                                                            <tr>
                                                                <td>@item.EAN</td>
                                                                <td style="text-align:left;">@item.Descripcion</td>
                                                                <td style="text-align:right;">@item.Piezas</td>
                                                                <td style="text-align:left;">@item.TipoEnvio</td>
                                                                <td style="text-align:center;"><input type="checkbox" value="@item.EAN" class="checkbox" id="flexCheckDefault"></td>
                                                            </tr>



                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-12 col-md-12 col-lg-12">
                                                <table style="width:100%">
                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                            <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">
                                                                Aceptar Consignación
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                            <select id="ddlMotCan" class="form-control">
                                                                @{
                                                                    if (ViewBag.MotCan != null)
                                                                    {
                                                                        IEnumerable<OrderFacts_UE_CancelCauses> listCan = ViewBag.MotCan as IEnumerable<OrderFacts_UE_CancelCauses>;
                                                                        foreach (OrderFacts_UE_CancelCauses item in listCan)
                                                                        {
                                                                            <option value="@item.IdCause">@item.Cause_Desc</option>

                                                                        }
                                                                        <option value="99">Otro</option>

                                                                    }

                                                                }
                                                            </select>


                                                        </td>
                                                        <td></td>
                                                        <td>
                                                            <button type="button" id="btnCancelarConsig" class="btn btn-primary block full-width m-b" onclick="Cancelar()"> Cancelar  Consignación </button>
                                                            @*<button type="button" id="btnCancelarConsig" class="btn btn-primary block full-width m-b" onclick="alert('La siguiente consignación será cancelada por el siguiente motivo')"> Cancelar  Consignación </button>*@
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td><textarea id="txtOtro" maxlength="50" placeholder="Describir Otro" class="form-control" rows="4" cols="50"></textarea></td>
                                                        <td></td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" id="tab-2" class="tab-pane">
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-sm-12 col-md-12 col-lg-12">
                                                <table id="tblSolicitutGuia" style="width:100%" class="table table-striped table-bordered table-hover table-responsive-md expand dataTable no-footer">
                                                    <thead class="bg-danger-sor" style="width:100%">
                                                        <tr>
                                                            <th style="text-align:center;">EAN</th>
                                                            <th style="text-align:center;">Descripción</th>
                                                            <th style="text-align:center;">Piezas</th>
                                                            <th style="text-align:center;">Artículo en guía</th>
                                                        </tr>
                                                    </thead>

                                                </table>
                                                <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">
                                                    Solicitar Guía
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center;">No. de Guía</th>
                                                        <th style="text-align:center;">Alto (mts)</th>
                                                        <th style="text-align:center;">Largo (mts)</th>
                                                        <th style="text-align:center;">Ancho (mts)</th>
                                                        <th style="text-align:center;">Peso (kg)</th>
                                                        <th style="text-align:center;">Peso REAL</th>
                                                        <th style="text-align:center;">Tipo Envío</th>
                                                        <th style="text-align:center;">Total de artículos en guía</th>
                                                        <th>    </th>
                                                    </tr>
                                                </thead>
                                                <tr>
                                                    <td>Guía 2</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td>71 (en automático)</td>
                                                    <td>Paquetería (en automático)</td>
                                                    <td>ES LA SUMA EN AUTOMÁTICO DE LOS ARTÍCULOS SELECCIONADOS EN EL DETALLE</td>
                                                    <td>
                                                        <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">
                                                            Confirmar solicitud de guía
                                                        </button>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div role="tabpanel" id="tab-3" class="tab-pane">
                                    <div class="panel-body">
                                        <div class="tableFixHead table-responsive m-t">
                                            <table id="tblDescargaGuia" class="table invoice-table">
                                                <thead>
                                                    <tr>
                                                        <th style="text-align:center;">No. Guía</th>

                                                        <th style="text-align:center;">ID</th>
                                                        <th style="text-align:center;">Descripción</th>

                                                        <th style="text-align:center;">Peso Real</th>
                                                        <th style="text-align:center;">Tipo Envío</th>

                                                        <th> </th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align:center;">4562734567898230000000</td>
                                                        <td style="text-align:center;">1234567</td>

                                                        <td style="text-align:left;">Licon Caballero</td>

                                                        <td style="text-align:left;">Paquetería</td>

                                                        <td><a href="" id="btnAceptConsig" class="btn btn-primary block full-width m-b" download="">Descargar Archivo</a> </td>
                                                        <td> <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">  Ver Detalles de Guia </button></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="text-align:center;">4562734567898230000000</td>
                                                        <td style="text-align:center;">1234567</td>
                                                        <td style="text-align:left;">Licon Caballero</td>

                                                        <td style="text-align:left;">Paquetería</td>
                                                        <td><a href="" id="btnAceptConsig" class="btn btn-primary block full-width m-b" download="">Descargar Archivo</a> </td>
                                                        <td> <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">  Ver Detalles de Guia </button></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="text-align:center;">4562734567898230000000</td>
                                                        <td style="text-align:center;">1234567</td>
                                                        <td style="text-align:left;">Licon Caballero</td>
                                                        <td style="text-align:left;">Paquetería</td>
                                                        <td><a href="" id="btnAceptConsig" class="btn btn-primary block full-width m-b" download="">Descargar Archivo</a> </td>
                                                        <td> <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">  Ver Detalles de Guia </button></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="text-align:center;">4562734567898230000000</td>
                                                        <td style="text-align:center;">1234567</td>
                                                        <td style="text-align:left;">Licon Caballero</td>
                                                        <td style="text-align:left;">Paquetería</td>
                                                        <td><a href="" id="btnAceptConsig" class="btn btn-primary block full-width m-b" download="">Descargar Archivo</a> </td>
                                                        <td> <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">  Ver Detalles de Guia </button></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="text-align:center;">4562734567898230000000</td>
                                                        <td style="text-align:center;">1234567</td>
                                                        <td style="text-align:left;">Licon Caballero</td>
                                                        <td style="text-align:left;">Paquetería</td>
                                                        <td><a href="" id="btnAceptConsig" class="btn btn-primary block full-width m-b" download="">Descargar Archivo</a> </td>
                                                        <td> <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">  Ver Detalles de Guia </button></td>
                                                    </tr>
                                                    <tr>
                                                        <td style="text-align:center;">4562734567898230000000</td>
                                                        <td style="text-align:center;">1234567</td>
                                                        <td style="text-align:left;">Licon Caballero</td>
                                                        <td style="text-align:left;">Paquetería</td>
                                                        <td> <a href="" id="btnAceptConsig" class="btn btn-primary block full-width m-b" download="">Descargar Archivo</a> </td>
                                                        <td> <button type="button" id="btnAceptConsig" class="btn btn-primary block full-width m-b" onclick="clickLogin()">  Ver Detalles de Guia </button></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="row">
                                            <table>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        msj mensaje = @ViewBag.Mensaje as msj;

                        <div class="row">
                            <div class="col col-xs-12 col col-md-12 col col-lg-12 text-center">
                                <div class="alert alert-danger">
                                    @mensaje.mensaje
                                </div>
                            </div>
                        </div>
                    }

                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>

        $(document).ready(function () {
            GetSolicitarGuia();
        });

        function GetSolicitarGuia() {

            //var _Id_Num_UN = $("#hddTda").val();

            debugger;

            $.ajax({
                async: false,
                type: "POST",
                url: '@Url.Action("GetSolicitarGuia", "ProcesoSurtido")',
                data: {
                    //  Id_Num_UN: _Id_Num_UN
                },

                datatype: "json",
                success: function (json) {
                    if (json.Success) {



                        //$("#tblSolicitutGuia tbody").empty();

                        //debugger;
                        //if (json.Message.mensaje.length != 0) {
                        //    tr = $('<tr/>');
                        //    //tr.append("<td class='row1'>" + json.json[i].Id_Num_Orden + "</td>");
                        //    tr.append("<td colpan='4'>" + json.Message[i].mensaje + "</td>");

                        //    $('#tblSolicitutGuia').append(tr);
                        //}

                        var table = $('#tblSolicitutGuia').DataTable();

                        table.clear().draw();
                        table.destroy();



                        table.row.add([
                            '1'
                            , '1'
                            , '1'
                            , '1'

                        ]).draw();

                        iniciatblSolicitutGuia();

                    }
                    else {
                        bootbox.alert(Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }

            });

        }

        $("#ddlMotCan")
            .change(function () {

                $("#txtOtro").val('');
                if ($("#ddlMotCan").val() == "99") {
                        $("#txtOtro").focus();
                }

            })

        function Cancelar() {
            var dll = $("#ddlMotCan");

            var _Cause_Desc = $("#ddlMotCan option:selected").text();
            var __IdCause = dll.val();//document.getElementById("ddlMotCan").value; //$("#ddlMotCan").val()

            if (_Cause_Desc == "99") {
                if ($("#txtOtro").val() == "") {
                    $("#txtOtro").focus();
                    return;
                }
                else {
                    _Cause_Desc = $("#txtOtro").val();
                }
            }
            debugger;
             $.ajax({
                async: false,
                type: "GET",
                url: '@Url.Action("Cancelar", "ProcesoSurtido")',
                data: {
                    Cause_Desc: _Cause_Desc
                    , IdCause: __IdCause
                },

                datatype: "json",
                success: function (json) {
                    if (json.Success) {
                        location.reload();
                    }
                    else {
                        bootbox.alert(Message);
                    }
                }
                , error: function (jqXHR, textStatus, errorThrown) {
                    bootbox.alert(errorThrown);
                }

            });
        }
    </script>

    @*CONFIGURACION DE TABLAS, FILTROS, BOTONES DE EXPORT*@
    <script>

        $(document).ready(function () {
            $('#tblAcepConsig thead tr').clone(true).appendTo('#tblAcepConsig thead');
            $('#tblAcepConsig thead tr:eq(1) th').each(function (i) {
                if ($(this).attr('name') != "accion") {
                    var title = $(this).text();
                    $(this).html('<input type="text" class="form form-control input-sm" placeholder="' + title + '" />');

                    $('input', this).on('keyup change', function () {
                        if (table.column(i).search() !== this.value) {
                            table
                                .column(i)
                                .search(this.value)
                                .draw();
                        }
                    });
                } else {
                    $(this).empty();
                }
            });

            table = $("#tblAcepConsig").DataTable(
                {
                    dom: "<'row'<'col col-xs-6'B><'#topRightSection.col-xs-12 col-md-6 text-right' f>>" +
                        "<'row'<'col-sm-12'tr>>" +
                        "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'lp>>",
                    processing: true,
                    searching: true,
                    ordering: true,
                    order: [[1, 'asc']],
                    filter: true,
                    info: false,
                    stateSave: false,
                    select: false,
                    select: {
                        style: 'single'
                    },
                    //Paggin

                    paging: true,
                    pageLength: 10,
                    lengthMenu: [10, 25, 50, 100, 500],

                    // destroy: true, //destruye automaticamente la referencia a la tabla
                    //Ajax
                    //serverSide: true,
                    //bServerSide: true,
                    //sServerMethod: "GET",
                    buttons: ['csv', 'excel'],
                    orderCellsTop: false,
                    fixedHeader: {
                        header: true
                    },
                    "scrollX": true

                }
            );



        });

        function iniciatblSolicitutGuia() {
            $("#tblSolicitutGuia").DataTable(
                {
                    dom: "<'row'<'col col-xs-6'B><'#topRightSection.col-xs-12 col-md-6 text-right' f>>" +
                        "<'row'<'col-sm-12'tr>>" +
                        "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'lp>>",
                    processing: true,
                    searching: true,
                    ordering: true,
                    order: [[1, 'asc']],
                    filter: true,
                    info: false,
                    stateSave: false,
                    select: false,
                    select: {
                        style: 'single'
                    },
                    //Paggin

                    paging: true,
                    pageLength: 10,
                    lengthMenu: [10, 25, 50, 100, 500],

                    //destroy: true, //destruye automaticamente la referencia a la tabla
                    //Ajax
                    //serverSide: true,
                    //bServerSide: true,
                    //sServerMethod: "GET",
                    buttons: ['csv', 'excel'],
                    orderCellsTop: false,
                    fixedHeader: {
                        header: true
                    },
                    "scrollX": true,
                    @* "language": {

                "emptyTable": '@ViewBag.MensajeSolGuia'
            }*@
                }
            );
        }
    </script>
}